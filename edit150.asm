STRING          = $0000
STRING+1        = $0001
OSHWM           = $0002
PAJE+1          = $0003
TMAX            = $0004
TMAX+1          = $0005
TEMP            = $0006
TEMP+1          = $0007
ADDR            = $0008
ADDR+1          = $0009
ARGP            = $000A
ARGP+1          = $000B
VARP            = $000C
VARP+1          = $000D
L000E           = $000E
L000F           = $000F
GS              = $0010
GS+1            = $0011
GE              = $0012
GE+1            = $0013
L0014           = $0014
L0015           = $0015
L0016           = $0016
L0017           = $0017
SMATLO          = $0018
SMATLO+1        = $0019
SMATHI          = $001A
SMATHI+1        = $001B
UMATLO          = $001C
UMATLO+1        = $001D
UMATHI          = $001E
UMATHI+1        = $001F
HIMEM           = $0020
HYMEM+1         = $0021
L0022           = $0022
L0023           = $0023
BRKACT          = $0024
SIZE            = $0025
SIZE+1          = $0026
L0027           = $0027
L0028           = $0028
L0029           = $0029
L002A           = $002A
options         = $002B
MODFLG          = $002C
L002D           = $002D
L002E           = $002E
L002F           = $002F
PAGEWI          = $0030
PAGELE          = $0031
REALPA          = $0032
L0033           = $0033
L0034           = $0034
UPDATE          = $0035
L0036           = $0036
SCRNX           = $0037
L0038           = $0038
L0039           = $0039
CURSED          = $003A
L003B           = $003B
L003C           = $003C
L003D           = $003D
L003E           = $003E
NUMMAR          = $003F
MARKSB          = $0040
CURRLEN         = $0041
NEXTREADFLAG    = $0042
NEXTCHR         = $0043
L0044           = $0044
L0045           = $0045
L0046           = $0046
L0047           = $0047
L0048           = $0048
L0049           = $0049
L004A           = $004A
L004B           = $004B
LINE            = $004C
L004D           = $004D
L004E           = $004E
mark_count      = $004F
MARKX           = $0050
L0051           = $0051
L0052           = $0052
L0053           = $0053
L0054           = $0054
L0055           = $0055
L0056           = $0056
L0057           = $0057
L005A           = $005A
ENDP            = $005B
ENDP+1          = $005C
L005D           = $005D
L005E           = $005E
TEXTP           = $005F
TEXTP+1         = $0060
addrpointer     = $0061
L0062           = $0062
L0063           = $0063
L0064           = $0064
L0065           = $0065
L0066           = $0066
L0067           = $0067
L0068           = $0068
L0069           = $0069
L006A           = $006A
L006B           = $006B
L006C           = $006C
L006D           = $006D
L006E           = $006E
L006F           = $006F
L0070           = $0070
L0071           = $0071
L0072           = $0072
L0073           = $0073
L0074           = $0074
L007B           = $007B
L007C           = $007C
L007D           = $007D
L007E           = $007E
L007F           = $007F
L0080           = $0080
termin          = $0081
L0083           = $0083
L0084           = $0084
L0085           = $0085
L0087           = $0087
L008D           = $008D
L008F           = $008F
L0090           = $0090
L0091           = $0091
L0093           = $0093
L0095           = $0095
L009A           = $009A
L009D           = $009D
L009E           = $009E
L009F           = $009F
L00A6           = $00A6
L00A7           = $00A7
L00A8           = $00A8
L00AC           = $00AC
L00B1           = $00B1
L00B2           = $00B2
L00B5           = $00B5
L00BE           = $00BE
L00C9           = $00C9
L00CA           = $00CA
L00D8           = $00D8
L00DE           = $00DE
L00E8           = $00E8
L00F2           = $00F2
L00F4           = $00F4
L00F9           = $00F9
L00FD           = $00FD
L00FF           = $00FF
L019F           = $019F
L01A0           = $01A0
L01B1           = $01B1
USERV           = $0200
BRKV            = $0202
BRKV+1          = $0203
IRQ1V           = $0204
IRQ2V           = $0206
CLIV            = $0208
BYTEV           = $020A
WORDV           = $020C
WRCHV           = $020E
RDCHV           = $0210
FILEV           = $0212
ARGSV           = $0214
BGETV           = $0216
BPUTV           = $0218
GBPBV           = $021A
FINDV           = $021C
FSCV            = $021E
EVNTV           = $0220
UPTV            = $0222
NETV            = $0224
VDUV            = $0226
KEYV            = $0228
INSV            = $022A
REMV            = $022C
CNPV            = $022E
IND1V           = $0230
IND2V           = $0232
IND3V           = $0234
L0400           = $0400
L0464           = $0464
L04C8           = $04C8
L04FC           = $04FC
L04FD           = $04FD
L04FE           = $04FE
L04FF           = $04FF
LINBUFF         = $0500
LINBUFF+1       = $0501
L0502           = $0502
L0503           = $0503
L0514           = $0514
L0515           = $0515
L0516           = $0516
L0517           = $0517
L0518           = $0518
L0519           = $0519
L051A           = $051A
L051B           = $051B
L051C           = $051C
L051D           = $051D
L052F           = $052F
L0530           = $0530
L0531           = $0531
L056C           = $056C
L05FE           = $05FE
L05FF           = $05FF
L0600           = $0600
L0601           = $0601
L060A           = $060A
L060D           = $060D
L06A0           = $06A0
L0700           = $0700
L0706           = $0706
L070C           = $070C
L0712           = $0712
L0718           = $0718
L071E           = $071E
L0728           = $0728
L0732           = $0732
L0733           = $0733
machtype        = $0752
L0C00           = $0C00
L0D0D           = $0D0D
L0D73           = $0D73
L0E8E           = $0E8E
L1576           = $1576
L1818           = $1818
L183C           = $183C
L187E           = $187E
L1CFE           = $1CFE
L2017           = $2017
L2065           = $2065
L20EA           = $20EA
L24EA           = $24EA
L2665           = $2665
L2E65           = $2E65
L336A           = $336A
L366E           = $366E
L4443           = $4443
L4853           = $4853
L4C58           = $4C58
L4D44           = $4D44
L5820           = $5820
L5C90           = $5C90
L5DB4           = $5DB4
L6120           = $6120
L6165           = $6165
L638C           = $638C
L63A6           = $63A6
L6428           = $6428
L64A7           = $64A7
L6528           = $6528
L6575           = $6575
L65A7           = $65A7
L66A7           = $66A7
L68A7           = $68A7
L696C           = $696C
L6974           = $6974
L69A7           = $69A7
L6AA7           = $6AA7
L6F63           = $6F63
L6F74           = $6F74
L732C           = $732C
L73A8           = $73A8
L74A8           = $74A8
L7794           = $7794
L7F0D           = $7F0D
L7F13           = $7F13
L7FA9           = $7FA9
LD096           = $D096
defvec          = $D940
LDAB2           = $DAB2
LE8FF           = $E8FF
LEA00           = $EA00
LEA0B           = $EA0B
LF1BA           = $F1BA
OSRDRM          = $FFB9
VDUCHR          = $FFBC
OSEVEN          = $FFBF
GSINIT          = $FFC2
GSREAD          = $FFC5
NVRDCH          = $FFC8
NVWRCH          = $FFCB
OSFIND          = $FFCE
OSGBPB          = $FFD1
OSBPUT          = $FFD4
OSBGET          = $FFD7
OSARGS          = $FFDA
OSFILE          = $FFDD
OSRDCH          = $FFE0
OSASCI          = $FFE3
OSNEWL          = $FFE7
OSWRCH          = $FFEE
OSWORD          = $FFF1
OSBYTE          = $FFF4
OSCLI           = $FFF7

                org     $8000
.langent        JMP     language

.servent        JMP     service

                ASL     A
                EQUS    "EDIT"

                EQUB    $00

                EQUS    "1.50r"

                EQUB    $00

                EQUS    "(C)1989 Acorn"

                EQUB    $0A,$0D

.L8023          BRK
                EQUB    $00

                CLV
                PLP
                BRA     L7FA9

                LDA     L0083,X
.service        PHA
                TAX
                TYA
                PHA
                CPX     #$04
                BEQ     command

                CPX     #$09
                BNE     notme

                LDA     (L00F2),Y
                CMP     #$0D
                BNE     notme

                JSR     OSNEWL

                LDX     #$F6
.prnthelp       LDA     L7F13,X
                BNE     L804A

                LDA     #$20
.L804A          JSR     OSASCI

                INX
                BNE     prnthelp

                JSR     OSNEWL

.notme          PLA
                TAY
                LDX     L00F4
                PLA
                RTS

.command        LDX     #$FC
.L805B          LDA     (L00F2),Y
                CMP     #$2E
                BEQ     startaslang

                AND     #$DF
                CMP     L7F0D,X
                BNE     notme

                INY
                INX
                BNE     L805B

                LDA     (L00F2),Y
                CMP     #$21
                BCS     notme

.startaslang    LDX     L00F4
                LDA     #$8E
                JMP     OSBYTE

.L8079          EQUB    $A2

                EQUB    $FF,$9A,$64,$3A,$20,$32,$81,$A5
                EQUB    $24,$C9,$FF,$D0,$24,$A5,$08,$D0
                EQUB    $02,$C6,$09,$C6,$08,$A5,$0A,$D0
                EQUB    $02,$C6,$0B,$C6,$0A,$B2,$0A,$92
                EQUB    $08,$A5,$08,$D0,$E8,$A5,$09,$C5
                EQUB    $01,$D0,$E2,$A9,$0D,$92,$04,$A9
                EQUB    $00,$C9,$01,$D0,$06,$20,$37,$81
                EQUB    $4C,$74,$B3,$90,$06,$20,$DA,$AB
                EQUB    $20,$5D,$B1,$20,$32,$85,$03,$0F
                EQUB    $EA,$20,$35,$98,$20,$1A,$8C,$20
                EQUB    $32,$85,$0B,$0B,$0B,$82,$EA,$A2
                EQUB    $80,$A9,$EB,$20,$27,$85

                EQUS    "Shift f5 D for info"

                EQUB    $83,$81,$EA

.L80EE          LDX     #$20
                LDA     #$FE
                JSR     L8527

                STA     (L0084,X)
                NOP
                LDX     #$80
                LDA     #$E6
                JSR     L8527

                EQUS    "Press ESCAPE to continue"

.L8117          STA     ARGP+1
                ORA     #$EA
                JSR     L813A

                JSR     L8C77

.L8122          JSR     OSRDCH

                CMP     #$1B
                BNE     L8122

.L8129          JSR     ackesc

                JSR     NORMAL

                JMP     L8587

.ackesc         LDA     #$7E
                JMP     OSBYTE

                JSR     OSNEWL

.L813A          LDY     #$01
.L813C          LDA     (L00FD),Y
                BEQ     L8146

                JSR     OSASCI

                INY
                BNE     L813C

.L8146          RTS

.language       CLI
                CLD
                LDX     #$FF
                TXS
                LDA     #$00
                LDX     #$01
                JSR     OSBYTE

                CPX     #$03
                BCC     getsettings

                TXA
.getsettings    STA     machtype
                LDA     #$A1
                LDX     #$08
                JSR     OSBYTE

                STY     options
                TYA
                LDY     #$0D
                AND     #$40
                BEQ     L816D

                LDY     #$0A
.L816D          STY     termin
                LDA     #$79
                STA     BRKV
                LDA     #$80
                STA     BRKV+1
                STZ     L04FF
                LDA     #$F2
                STA     addrpointer
                STZ     L0062
                JSR     readiomem

                TAX
                JSR     L829C

                STA     L0062
                STX     addrpointer
                LDX     #$14
.L818F          DEX
                BEQ     L81F4

                JSR     L829C

                CMP     #$0D
                BEQ     L8213

                CMP     #$20
                BEQ     L81A1

                CMP     #$2E
                BNE     L818F

.L81A1          DEX
                BEQ     L8213

                JSR     L829C

                CMP     #$20
                BEQ     L81A1

                LDX     #$00
.L81AD          STA     L01A0,X
                JSR     L829C

                INX
                CPX     #$40
                BNE     L81AD

                LDA     #$0D
                STA     L019F,X
                STA     L04C8
                LDY     #$00
                JSR     L826E

                BCC     L81ED

                CMP     #$2C
                BNE     L81ED

                LDA     STRING,X
                STA     L04FC
                LDA     STRING+1,X
                STA     L04FD
                INY
                JSR     L826E

                BCC     L81ED

                CMP     #$0D
                BNE     L81ED

                LDA     STRING,X
                STA     L04FE
                LDA     STRING+1,X
                STA     L04FF
                STZ     CURSED
                BRA     L8229

.L81ED          LDX     #$00
                LDA     L01A0
                CMP     #$0D
.L81F4          BEQ     L8213

.L81F6          LDA     L01A0,X
                CMP     #$0D
                BEQ     L8205

                CMP     #$20
                BCC     L8213

                CMP     #$7F
                BCS     L8213

.L8205          STA     L04C8,X
                INX
                CMP     #$0D
                BNE     L81F6

                LDA     #$01
                STA     CURSED
                BRA     L8229

.L8213          LDX     #$FF
                STX     CURSED
                LDA     #$0D
                STA     L04C8
                LDA     termin
                CMP     (OSHWM)
                BNE     L8229

                CMP     (TMAX)
                BNE     L8229

                JSR     L84EB

.L8229          LDA     #$0D
                STA     L0400
                STA     L0464
                STZ     L004E
                STZ     MODFLG
                LDA     #$03
                JSR     OSWRCH

                LDA     CURSED
                BEQ     L8244

                DEC     A
                BEQ     L824A

                JMP     L857B

.L8244          JSR     LB19C

                JMP     LB452

.L824A          STZ     BRKACT
                JSR     LB19C

                JSR     LB141

                LDY     #$00
                LDA     #$C8
                STA     TEMP
                LDA     #$04
                STA     TEMP+1
                JSR     L835F

                JMP     L8582

.addreadfrom    LDX     #$61
                LDY     #$00
                RTS

.L8267          INC     addrpointer
                BNE     L826D

                INC     L0062
.L826D          RTS

.L826E          LDX     #$00
                STZ     L0066
.L8272          LDA     L01A0,Y
                CMP     #$30
                BCC     L8297

                CMP     #$3A
                BCC     L8287

                SBC     #$37
                CMP     #$0A
                BCC     L8297

                CMP     #$10
                BCS     L8297

.L8287          ASL     L0066
                ASL     L0066
                ASL     L0066
                ASL     L0066
                AND     #$0F
                TSB     L0066
                INY
                INX
                BRA     L8272

.L8297          CPX     #$01
                LDX     L0066
                RTS

.L829C          JSR     L8267

.readiomem      PHX
                PHY
                JSR     addreadfrom

                LDA     #$05
                JSR     OSWORD

                PLY
                PLX
                LDA     L0065
                RTS

.L82AE          PHP
                SEC
                SBC     ADDR
                STA     L0027
                TXA
                SBC     ADDR+1
                STA     L0028
                PLP
.L82BA          LDA     (TEMP),Y
                CMP     #$0D
                BEQ     L82EE

                CMP     #$8B
                BEQ     L82DE

                BVC     L82D1

                CLC
                TYA
                ADC     TEMP
                TAX
                LDA     TEMP+1
                ADC     #$00
                BRA     L82E9

.L82D1          LDX     #$00
.L82D3          LDA     (TEMP),Y
                STA     L04C8,X
                INY
                INX
                CPX     #$34
                BNE     L82D3

.L82DE          LDA     L04C8
                CMP     #$0D
                BEQ     L8327

                LDX     #$C8
                LDA     #$04
.L82E9          STX     addrpointer
                STA     L0062
                RTS

.L82EE          LDX     GE
                LDY     GE+1
                PHX
                PHY
                LDX     L0022
                LDY     L0023
                JSR     GPBKXY

                LDY     #$00
.L82FD          LDA     (GE),Y
                STA     L0600,Y
                INY
                BNE     L82FD

                PLY
                PLX
                JSR     L996F

                LDY     #$FF
.L830C          INY
                BMI     L8327

                LDA     L0600,Y
                CMP     termin
                BEQ     L8327

                CMP     #$3E
                BNE     L830C

                INY
                STY     addrpointer
.L831D          LDA     L0600,Y
                CMP     termin
                BEQ     L833A

                INY
                BPL     L831D

.L8327          TYA
                BEQ     L830C

                BRK
                EQUB    $01

                EQUS    "No name found"

                EQUB    $00

.L833A          LDA     #$0D
                STA     L0600,Y
                LDA     #$06
                STA     L0062
                RTS

.L8344          JSR     LB030

                LDY     #$FF
.L8349          INY
                LDA     (addrpointer),Y
                CMP     #$20
                BEQ     L8349

.L8350          LDA     (addrpointer),Y
                CMP     #$21
                BCC     L835C

                JSR     OSWRCH

                INY
                BRA     L8350

.L835C          JMP     LB01C

.L835F          LDA     L0022
                STA     ADDR
                LDA     L0023
                STA     ADDR+1
                LDA     TMAX
                LDX     TMAX+1
                CLV
                JSR     L82AE

                JSR     L97FE

                EQUS    "Loading "

                EQUB    $EA,$20,$44,$83

.getfilesys     LDY     #$00
                TYA
                JSR     OSARGS

                CMP     #$04
                BCC     loadfile

                LDA     #$05
                JSR     addreadfrom

                JSR     OSFILE

                CMP     #$01
                BNE     loadfile

                LDA     L006D
                ORA     L006E
                BNE     L83C9

                LDA     L0027
                CMP     L006B
                LDA     L0028
                SBC     L006C
                BCC     L83C9

.loadfile       LDA     ADDR
                STA     L0063
                LDA     ADDR+1
                STA     L0064
                STZ     L0065
                STZ     L0066
                STZ     L0067
                LDA     #$FF
                JSR     addreadfrom

                JSR     OSFILE

                STZ     L04FF
                CLC
                LDA     ADDR
                ADC     L006B
                TAX
                LDA     ADDR+1
                ADC     L006C
                TAY
                RTS

.L83C9          BRK
                EQUB    $02

                EQUS    "File too big"

.L83D7          BRK
                EQUB    $B8

                JSR     L82BA

                JSR     L97FE

                EQUS    "Saving to "

.L83E9          NOP
                JSR     L8344

                LDX     #$0F
.L83EF          STZ     L0063,X
                DEX
                BPL     L83EF

                DEC     L0067
                DEC     L0068
                DEC     L0069
                DEC     L006A
                LDA     GE
                STA     L006B
                LDA     GE+1
                STA     L006C
                LDA     ENDP
                STA     L006F
                LDA     ENDP+1
                STA     L0070
                LDA     #$00
                JSR     addreadfrom

                JMP     OSFILE

                JSR     READLS

                TYA
                BEQ     L8424

.L841A          LDA     L04FF,Y
                CMP     #$20
                BNE     L8424

                DEY
                BNE     L841A

.L8424          LDA     #$0D
                STA     LINBUFF,Y
                LDY     #$FF
.L842B          INY
                LDA     LINBUFF,Y
                CMP     #$20
                BEQ     L842B

                CLC
.L8434          TYA
                ADC     #$00
                STA     TEMP
                LDA     #$00
                ADC     #$05
                STA     TEMP+1
                LDY     #$00
                LDA     (TEMP)
                CMP     #$0D
.L8445          RTS

                LDY     #$00
                BRA     L8434

.READLS         LDA     #$20
                JSR     OSWRCH

                LDA     #$06
                STA     UPDATE
                JSR     L8478

                BCC     L8445

.L8458          JSR     VSTRING

                ORA     LA5EA
                BIT     L00C9
                BNE     L846B

                JSR     LABDA

                JSR     STFILE

.L846B          STZ     CURSED
                JMP     L8129

.L8470          JSR     OSRDCH

.L8473          BIT     L00FF
                BMI     L8458

                RTS

.L8478          LDY     #$00
.L847A          JSR     L96BE

                STA     LINBUFF,Y
                CMP     #$7F
                BNE     L848E

                CPY     #$00
                BEQ     L847A

                DEY
                JSR     OSWRCH

                BRA     L847A

.L848E          CMP     #$15
                BNE     L849D

.L8492          TYA
                BEQ     L847A

                LDA     #$7F
                JSR     OSWRCH

                DEY
                BRA     L8492

.L849D          INY
                CMP     #$0D
                BEQ     L84A7

                JSR     LAFEC

                BRA     L847A

.L84A7          PHY
                JSR     L961A

                PLY
                DEY
                CLC
                RTS

.L84AF          STX     SIZE
                STY     SIZE+1
                LDA     SIZE
                ORA     SIZE+1
                BEQ     L84EA

                LDX     SIZE+1
                SEC
                LDA     #$00
                SBC     SIZE
                TAY
                BEQ     L84DC

                STA     TEMP
                SEC
                LDA     ARGP
                SBC     TEMP
                STA     ARGP
                BCS     L84D1

                DEC     ARGP+1
                SEC
.L84D1          LDA     VARP
                SBC     TEMP
                STA     VARP
                BCS     L84DB

                DEC     VARP+1
.L84DB          INX
.L84DC          LDA     (ARGP),Y
                STA     (VARP),Y
                INY
                BNE     L84DC

                INC     ARGP+1
                INC     VARP+1
                DEX
                BNE     L84DC

.L84EA          RTS

.L84EB          LDA     L0023
                JSR     L851C

                LDA     GS+1
                JSR     L851C

                LDA     GE+1
                JSR     L851C

                LDA     TMAX+1
                JSR     L851C

                LDX     TMAX
                LDY     TMAX+1
                JSR     L996F

                LDA     L0022
                STA     L04FC
                LDA     L0023
                STA     L04FD
                LDA     GS
                STA     L04FE
                LDA     GS+1
                STA     L04FF
                CLC
.L851B          RTS

.L851C          CMP     HYMEM+1
                BCS     L851B

                CMP     PAJE+1
                BCS     L851B

                PLA
                PLA
                RTS

.L8527          SEC
                ADC     PAGEWI
                TAY
                TXA
.L852C          JSR     OSWRCH

                DEY
                BNE     L852C

.VSTRING        PLA
                STA     STRING
                PLA
                STA     STRING+1
                JSR     L8541

                JMP     (STRING)

.L853E          JSR     OSWRCH

.L8541          INC     STRING
                BNE     L8547

                INC     STRING+1
.L8547          LDA     (STRING)
                CMP     #$EA
                BNE     L853E

                RTS

                LDA     termin
                EOR     #$07
                STA     termin
                STA     (OSHWM)
                STA     (TMAX)
                LDA     #$40
                JSR     L8565

                JSR     STFILE

                JMP     STATUS

                LDA     #$20
.L8565          EOR     options
                STA     options
                PHX
                PHY
                TAY
                LDA     #$A2
                LDX     #$08
                JSR     OSBYTE

                PLY
                PLX
                RTS

.L8576          LDA     #$10
                BIT     options
                RTS

.L857B          JSR     LB19C

.L857E          LDX     L0022
                LDY     L0023
.L8582          STZ     MODFLG
.L8584          JSR     LB145

.L8587          LDX     #$FF
                TXS
                STZ     BRKACT
                JSR     L9591

.L858F          LDA     #$06
                STA     UPDATE
.L8593          JSR     LADFF

                JSR     L982F

                JSR     CURON

                LDA     #$05
                STA     UPDATE
                JSR     L96BE

                BNE     L8616

                TAX
                LDX     CURSED
                BNE     L8616

                TAX
                LDA     options
                AND     #$07
                CMP     #$05
                BNE     L860A

                CPX     #$9C
                BCS     L860A

                CPX     #$90
                BCS     L85BF

                CPX     #$8A
                BCS     L860A

.L85BF          TXA
                PHA
                ASL     A
                TAY
                JSR     VSTRING

                TRB     L0C00
                AND     ADDR+1,X
                TSB     LB9EA
                STA     L007B
                LDA     L87AC,Y
                STA     L007C
                JSR     LA113

                BRA     L8603

.L85DC          LDY     #$00
                JSR     OSNEWL

.L85E1          LDA     (STRING)
                INC     STRING
                BNE     L85E9

                INC     STRING+1
.L85E9          CMP     #$0D
                BEQ     L85F7

                CMP     #$EA
                BEQ     L8603

                JSR     OSWRCH

                INY
                BRA     L85E1

.L85F7          LDA     #$20
.L85F9          CPY     #$36
                BCS     L85DC

                JSR     OSWRCH

                INY
                BRA     L85F9

.L8603          JSR     DECWIN

                JSR     L982F

                PLX
.L860A          TXA
                ASL     A
                TAX
                JSR     L8613

                JMP     L8593

.L8613          JMP     (L874B,X)
.L8616          JSR     L861C

                JMP     L8593

.L861C          CMP     #$7F
                BEQ     L868A

                STZ     L04FF
                CMP     #$0D
                BNE     L8638

                JSR     L8576

                BNE     L8636

                JSR     ENDTES

                BCS     L8636

                STZ     SCRNX
                JMP     LB0B8

.L8636          LDA     termin
.L8638          PHA
                JSR     L99B0

                JSR     L8576

                BNE     L8649

                LDY     SCRNX
                LDA     (GE),Y
                CMP     termin
                BNE     L8650

.L8649          LDX     #$01
                LDA     SCRNX
                JSR     L99DE

.L8650          PLA
                LDY     SCRNX
                STA     (GE),Y
                CMP     termin
                BNE     L8676

                JSR     LAFFB

                LDA     SCRNX
                LDY     L0038
                JSR     LAEBE

                STZ     SCRNX
                JSR     LB0B8

.L8668          LDA     UPDATE
                BEQ     L866F

                JSR     LADFF

.L866F          LDA     #$02
                STA     UPDATE
                JMP     MODIFY

.L8676          JSR     LAFEC

                JSR     LB0A7

.L867C          LDA     UPDATE
                BEQ     L8683

                JSR     LADFF

.L8683          LDA     #$01
                STA     UPDATE
                JMP     MODIFY

.L868A          JSR     L99D4

                BEQ     L8692

                JMP     LB039

.L8692          LDA     SCRNX
                BNE     L869B

                JSR     L95D3

                BCS     L86F6

.L869B          JSR     LB039

                JSR     LENGTH

                CMP     SCRNX
                BCS     L86A7

                STA     SCRNX
.L86A7          LDY     SCRNX
                JSR     L8576

                BNE     L86BF

                LDA     (GE),Y
                CMP     termin
                BEQ     L86F6

                LDA     #$20
                STA     (GE),Y
                LDA     #$01
                STA     UPDATE
                JMP     MODIFY

.L86BF          LDA     (GE),Y
                CMP     termin
                BEQ     L86D0

                LDA     CURRLEN
                CMP     PAGEWI
                BEQ     L86D0

                JSR     L870F

                BRA     L867C

.L86D0          JSR     L870F

                BRA     L8668

.L86D5          JSR     L86EB

                STZ     SCRNX
                LDA     (GE)
                CMP     termin
                BNE     L86D5

                JSR     LENGTH

                STA     CURRLEN
                JSR     L86EB

                JMP     L866F

.L86EB          JSR     ENDTES

                BCC     L86F7

                LDA     SCRNX
                CMP     CURRLEN
                BCC     L86F7

.L86F6          RTS

.L86F7          LDA     CURRLEN
                CMP     SCRNX
                BCC     L86F6

                LDY     #$01
                STY     UPDATE
                CMP     PAGEWI
                BEQ     L870D

                LDY     SCRNX
                LDA     (GE),Y
                CMP     termin
                BNE     L870F

.L870D          INC     UPDATE
.L870F          JSR     MODIFY

                CLC
                LDA     GE
                STA     TEMP
                ADC     SCRNX
                STA     ADDR
                LDA     GE+1
                STA     TEMP+1
.L871F          ADC     #$00
L8720 = L871F+1
                STA     ADDR+1
                INC     GE
                BNE     L8729

                INC     GE+1
.L8729          LDY     SCRNX
                BRA     L8731

.L872D          LDA     (TEMP),Y
                STA     (GE),Y
.L8731          DEY
                BPL     L872D

                LDX     MARKX
.L8736          DEX
                BMI     L86F6

.L8739          LDY     SMATLO,X
L873A = L8739+1
                CPY     ADDR
                LDA     SMATHI,X
                SBC     ADDR+1
                BCS     L8736

                INC     SMATLO,X
.L8745          BNE     L8736

L8746 = L8745+1
                INC     SMATHI,X
                BRA     L8736

.L874B          SBC     L5DB4,X
                EOR     (L00B2,X)
                STA     LDAB2,Y
                TSX
                BIT     LF1BA,X
                LDY     MKCPY,X
                LDX     #$52
                LDY     options,X
                TXS
                STX     L0039
                BCS     L870D

                BCS     L8720

                BCS     L87B4

                BCS     L87CF

                STA     L00FD
                STX     HYMEM+1,Y
                CPX     L00B1
                ADC     (L009A)
                NOP
                ASL     A
                LDA     MKMVE,X
.L877B          BPL     L873A

L877C = L877B+1
                SBC     L01B1
                CLV
                ROL     L00B1
                INX
                BCS     L87ED

                STA     L9906,Y
                STA     L0093
                STA     L0093
                STA     L0093
                STA     L0093
                STA     L0093
                STA     L00D8
                LDA     (L00DE),Y
                LDA     (L004E),Y
                STA     L0093
                STA     L0093
                STA     L00D8
                STX     L0085
                BCS     L8746

                BCS     L880F

                LDA     (L005D),Y
                LDA     (VARP+1),Y
.L87AC          STA     L8DDF
                STX     L8F24
                LDX     #$90
                DEC     L0091,X
                STA     (SMATHI)
                LDY     L0093,X
                LDY     L0093,X
                LDY     L0093,X
                LDY     L0093,X
                LDY     L0093,X
                LDY     L0093,X
                LDY     L0093,X
                STZ     L008D
.L87CD          JMP     (L0E8E)

L87CF = L87CD+2
                EOR     (L008F)
                EOR     L5C90
                STA     (MARKSB),Y
                STA     (L00BE)
                STA     (L006D)
                ORA     L7794
                STY     L00F9,X
.L87E2          STY     HIMEM,X
BIGMESS = L87E2+1
                AND     (L0085)
                EQUS    "shf-f0"

.L87ED          BRA     L877C

                EQUS    "shf-f1"

                EQUB    $80,$8D

                EQUS    "shf-f2"

                EQUB    $80,$8D

                EQUS    "shf-f3"

                EQUB    $80,$8D

                EQUS    "shf-f4"

                EQUB    $80,$8D

.L880F          EQUS    "shf-f5"

                EQUB    $80,$8D

                EQUS    "shf-f6"

                EQUB    $80,$8D

                EQUS    "shf-f7"

                EQUB    $80,$8D

                EQUS    "shf-f8"

                EQUB    $80,$8D

                EQUS    "shf-f9"

                EQUB    $83,$81

                EQUS    "Display"

                EQUB    $81

                EQUS    "Insert/"

                EQUB    $81

                EQUS    "Insert "

                EQUB    $81

                EQUS    "Remove "

                EQUB    $81

                EQUS    "Return "

                EQUB    $81

                EQUS    " Set   "

                EQUB    $81

                EQUS    " Clear "

                EQUB    $81

                EQUS    "Marked "

                EQUB    $81

                EQUS    "Marked "

                EQUB    $81

                EQUS    "Clear "

                EQUB    $81,$81

                EQUS    "Returns"

                EQUB    $81

                EQUS    "Over   "

                EQUB    $81

                EQUS    " File  "

                EQUB    $81

                EQUS    "Margins"

                EQUB    $81

                EQUS    "Languag"

                EQUB    $81

                EQUS    " Mode  "

                EQUB    $81

                EQUS    " Marks "

                EQUB    $81

                EQUS    "Move   "

                EQUB    $81

                EQUS    "Delete "

                EQUB    $81

                EQUS    "Text  "

                EQUB    $81,$8E,$80,$80,$66,$30,$80,$80
                EQUB    $80,$91,$80,$80,$66,$31,$80,$80
                EQUB    $80,$91,$80,$80,$66,$32,$80,$80
                EQUB    $80,$91,$80,$80,$66,$33,$80,$80
                EQUB    $80,$91,$80,$80,$66,$34,$80,$80
                EQUB    $80,$91,$80,$80,$66,$35,$80,$80
                EQUB    $80,$91,$80,$80,$66,$36,$80,$80
                EQUB    $80,$91,$80,$80,$66,$37,$80,$80
                EQUB    $80,$91,$80,$80,$66,$38,$80,$80
                EQUB    $80,$91,$80,$80,$66,$39,$80,$80
                EQUB    $8F,$81

                EQUS    " Goto  "

                EQUB    $81

                EQUS    "Command"

                EQUB    $81

                EQUS    " Load  "

                EQUB    $81

                EQUS    " Save  "

                EQUB    $81

                EQUS    " Find  "

                EQUB    $81

                EQUS    "Global "

                EQUB    $81

                EQUS    " Mark  "

                EQUB    $81

                EQUS    "Marked "

                EQUB    $81

                EQUS    " Print "

                EQUB    $81

                EQUS    " Old  "

                EQUB    $81,$81

                EQUS    " Line  "

                EQUB    $81

                EQUS    "Line   "

                EQUB    $81

                EQUS    " File  "

                EQUB    $81

                EQUS    " File  "

                EQUB    $81

                EQUS    "String "

                EQUB    $81

                EQUS    "Replace"

                EQUB    $81

                EQUS    " Place "

                EQUB    $81

                EQUS    "Copy   "

                EQUB    $81

                EQUS    " Text  "

                EQUB    $81

                EQUS    " Text "

                EQUB    $81,$84,$EA,$A2,$08,$20,$32,$85
                EQUB    $80,$80,$80,$80,$80,$80,$80,$90
                EQUB    $EA,$CA,$10,$F1,$20,$32,$85,$80
                EQUB    $80,$80,$80,$80,$80,$85,$EA,$60

.BIGMET         JSR     VSTRING

                EQUS    "The Acorn Screen Editor "

                EQUB    $86

                EQUS    " 1989 Acorn Computers Vn 1.50r "

                EQUB    $82,$80,$80,$80,$83

                EQUS    "Shift: screen up"

                EQUB    $20,$20,$20,$20,$20,$20,$20,$20
                EQUB    $20,$20,$20,$20,$20,$20,$20,$20
                EQUB    $20,$20,$20,$20,$20,$20,$20,$20
                EQUB    $20,$20,$20,$20,$20,$20,$20,$20
                EQUB    $20,$20

                EQUS    "Descriptive Mode"

                EQUB    $20,$20,$20,$20,$20,$20,$20,$20
                EQUB    $20,$81,$20,$8A,$20,$81

                EQUS    "Control: text startTAB performs tabulation controlled by shift T"
                EQUS    "AB.      "

                EQUB    $82,$80,$90,$80,$8D,$80,$90,$80
                EQUB    $83

                EQUS    "Shift: word l/r  COPY deletes the character above the cursor.   "
                EQUS    "       "

                EQUB    $81,$20,$87,$8C,$81,$8B,$88,$20
                EQUB    $81

                EQUS    "Control:         Shift COPY provides normal soft keys and cursor"
                EQUS    "       "

                EQUB    $84,$80,$8D,$80,$90,$80,$8D,$80
                EQUB    $85

                EQUS    "    l/r of line         copying (ESCAPE to leave this mode).    "
                EQUS    "         "

                EQUB    $81,$20,$89,$20,$81

                EQUS    "Shift: screen down Control COPY deletes the current line (to nex"
                EQUS    "t RETURN)  "

                EQUB    $84,$80,$80,$80,$85

                EQUS    "Control: text end  "

                EQUB    $EA,$60

.STARTI         LDX     #$11
                STX     L007F
                LDX     #$DC
                LDY     #$07
                STX     L007D
                STY     L007E
.L8C26          CLC
                LDA     L007F
                ADC     #$80
                STA     (L007D)
                LDA     #$0A
                LDX     L007D
                LDY     L007E
                JSR     OSWORD

                SEC
                LDA     L007D
                SBC     #$08
                STA     L007D
                BCS     L8C41

                DEC     L007E
.L8C41          DEC     L007F
                BPL     L8C26

                LDX     #$7D
                LDY     #$8C
.L8C49          STX     L007D
                STY     L007E
                LDX     #$00
.L8C4F          LDA     #$17
                JSR     OSWRCH

                TXA
                CLC
                ADC     #$80
                JSR     OSWRCH

                LDY     #$00
.L8C5D          LDA     (L007D),Y
                JSR     OSWRCH

                INY
                CPY     #$08
                BNE     L8C5D

                LDA     L007D
                ADC     #$07
                STA     L007D
                BCC     L8C71

                INC     L007E
.L8C71          INX
                CPX     #$12
                BNE     L8C4F

                RTS

.L8C77          LDX     #$55
                LDY     #$07
                BRA     L8C49

                BRK
                EQUB    $00

                BRK
                EQUB    $FF

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                CLC
                CLC
                CLC
                CLC
.L8C89          CLC
                CLC
                CLC
                CLC
                BRK
                EQUB    $00

                BRK
                EQUB    $07

                TSB     L1818
                CLC
                BRK
                EQUB    $00

                BRK
                EQUB    $E0

                BMI     L8CB3

                CLC
                CLC
                CLC
                CLC
                TSB     TEMP+1
                BRK
                EQUB    $00

                BRK
                EQUB    $18

                CLC
                BMI     L8C89

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                ROR     L9DC3,X
                LDA     (L009D),Y
.L8CB3          ROR     STRING,X
                CLC
                SEC
                SEC
                CLC
                BRK
                EQUB    $00

                BRK
                EQUB    $18

                TRB     L1CFE
                CLC
                BRK
                EQUB    $00

                CLC
                CLC
                CLC
                CLC
                ROR     L183C,X
                BRK
                EQUB    $00

                CLC
                BIT     L187E,X
                CLC
                CLC
                CLC
                BRK
                EQUB    $00

                BRK
                EQUB    $1F

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $F8

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $FF

                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                SED
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                BRK
                EQUB    $00

                BRK
                EQUB    $00

                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                CLC
                ROR     PAGEWI
                ORA     L638C
                EQUS    "cursor can be moved"

                EQUB    $92

                EQUS    "a new line."

                EQUB    $0D

                EQUS    "For this operation lines are"

                EQUB    $86

                EQUS    "sequences"

                EQUB    $0D

                EQUS    "ended by "

                EQUB    $8A,$2E,$EA,$87,$30,$0D,$8C

                EQUS    "ends of lines can be shown as a special"

                EQUB    $0D

                EQUS    "character so that they can be seen clearly."

                EQUB    $0D

                EQUS    "This alters with each press of "

                EQUB    $87,$30,$2E,$EA

.L8DDF          EQUB    $66,$31,$0D

                EQUS    "Commands"

                EQUB    $92

                EQUS    "the computer's operating system can be"

                EQUB    $0D

                EQUS    "given. "

                EQUB    $8C

                EQUS    "result is seen at once. Extra commands"

                EQUB    $0D

                EQUS    "can be entered until "

                EQUB    $8A

                EQUS    " by itself is typed."

                EQUB    $EA,$87,$31,$0D

                EQUS    "Changes between Insert and Over. In Insert mode the"

                EQUB    $0D,$8E

                EQUS    " typed is inserted causing"

                EQUB    $93

                EQUS    "existing"

                EQUB    $88,$74,$6F,$0D

                EQUS    "move. In Over mode the"

                EQUB    $88

                EQUS    "is typed over old "

                EQUB    $8E,$2E,$EA,$66,$8D

                EQUS    ", erasing"

                EQUB    $93

                EQUS    "current "

                EQUB    $8E,$8B,$EA,$87,$8D

                EQUS    " at"

                EQUB    $93

                EQUS    "current cursor"

                EQUB    $8B,$EA

.L8F24          EQUB    $66,$33,$0D

                EQUS    "All or 'mark"

                EQUB    $92

                EQUS    "cursor'"

                EQUB    $88

                EQUS    "will be saved"

                EQUB    $92

                EQUS    "a file"

                EQUB    $8B,$EA,$87,$33,$0D,$8C

                EQUS    "top and bottom"

                EQUB    $90

                EQUS    "have been removed."

                EQUB    $0D

                EQUS    "Set Top"

                EQUB    $91,$36,$0D

                EQUS    "Set Bottom"

                EQUB    $91,$37,$EA

                EQUS    "f4:- Interactive Find and Replace Function."

                EQUB    $0D,$8A,$92

                EQUS    "use last f4. Special search characters are:"

                EQUB    $0D

                EQUS    "# digit, $ "

                EQUB    $8A

                EQUS    ", . any, [ ] set of char, a-z a"

                EQUB    $92,$7A,$0D

                EQUS    "~ not, * many, ^ many, | control, @ alpha, \ literal."

                EQUB    $EA,$87,$34,$0D

                EQUS    "Return"

                EQUB    $92

                EQUS    "specified language."

                EQUB    $0D

                EQUS    "The"

                EQUB    $88,$69,$6E,$93

                EQUS    "buffer will be 'transferred' into the"

                EQUB    $0D

                EQUS    "language."

                EQUB    $EA

                EQUS    "f5:- Global replace.              All, or"

                EQUB    $89,$8E,$2E,$8A,$92

                EQUS    "use last f5. Special replace characters are:/"

                EQUB    $92

                EQUS    "begin"

                EQUB    $93

                EQUS    "replace section; & is"

                EQUB    $93

                EQUS    "found string"

                EQUB    $0D

                EQUS    "%n found wild section n. See f4 for find characters."

                EQUB    $EA,$87,$35,$0D,$8C

                EQUS    "screen mode may be set"

                EQUB    $92

                EQUS    "a specific mode. Also"

                EQUB    $0D

                EQUS    "Descriptive (D), or Key legend (K) modes may be set."

                EQUB    $0D

                EQUS    "D and K use mode 0."

                EQUB    $EA,$66,$36,$0D,$8C

                EQUS    "current position of"

                EQUB    $93

                EQUS    "cursor (_) is remembered."

                EQUB    $0D,$8C

                EQUS    "status line will show"

                EQUB    $93

                EQUS    "number of marks in use"

                EQUB    $0D

                EQUS    "(if any)."

                EQUB    $EA,$87,$36,$0D

                EQUS    "All place marks are cleared."

                EQUB    $0D,$0D,$EA,$66,$37,$0D

                EQUS    "The"

                EQUB    $88

                EQUS    "between two"

                EQUB    $89

                EQUS    "places is copied to"

                EQUB    $0D

                EQUS    "the current cursor position."

                EQUB    $0D,$8C

                EQUS    "marks are NOT cleared."

                EQUB    $EA,$87,$37,$0D

                EQUS    "The"

                EQUB    $88

                EQUS    "between two"

                EQUB    $89

                EQUS    "places is moved to"

                EQUB    $0D

                EQUS    "the current cursor position."

                EQUB    $0D,$8C

                EQUS    "marks are then cleared."

                EQUB    $EA,$66,$38,$0D,$8C

                EQUS    "whole"

                EQUB    $88

                EQUS    "is printed out"

                EQUB    $92

                EQUS    "the screen or printerusing"

                EQUB    $93

                EQUS    "built-in formatter/paginator."

                EQUB    $0D,$EA,$87,$38,$0D

                EQUS    "The"

                EQUB    $88

                EQUS    "between"

                EQUB    $93

                EQUS    "cursor and the"

                EQUB    $89

                EQUS    "place"

                EQUB    $0D

                EQUS    "is deleted."

                EQUB    $0D,$8C

                EQUS    "mark is then cleared."

                EQUB    $EA,$66,$39,$0D,$8C

                EQUS    "old"

                EQUB    $88,$69,$6E,$93

                EQUS    "buffer is recovered after a BREAK"

                EQUB    $0D

                EQUS    "or immediately after a Clear Text (by "

                EQUB    $87

                EQUS    "9)."

                EQUB    $0D,$EA,$87

                EQUS    "9 (ESCAPE to abandon)"

                EQUB    $0D

                EQUS    "All"

                EQUB    $88,$69,$6E,$93

                EQUS    "buffer is deleted."

                EQUB    $0D

                EQUS    "Use "

                EQUB    $87

                EQUS    "9 twice"

                EQUB    $92

                EQUS    "remove the"

                EQUB    $88

                EQUS    "beyond hope of a"

                EQUB    $0D

                EQUS    "recovery by f9."

                EQUB    $EA

                EQUS    "shf-TAB"

                EQUB    $0D,$8C

                EQUS    "TAB key may be used"

                EQUB    $92

                EQUS    "move"

                EQUB    $92

                EQUS    "zones of eight"

                EQUB    $0D

                EQUS    "characters across"

                EQUB    $93

                EQUS    "screen, or"

                EQUB    $92

                EQUS    "position under"

                EQUB    $0D

                EQUS    "the first"

                EQUB    $86,$6F,$66,$93

                EQUS    "line immediately above."

                EQUB    $EA

                EQUS    "shf-COPY"

                EQUB    $0D

                EQUS    "Cursor editing with"

                EQUB    $93

                EQUS    "cursor keys & COPY is enabled.User defined soft keys are availab"
                EQUS    "le as normal."

                EQUB    $0D

                EQUS    "All characters except ESCAPE are put into "

                EQUB    $8E,$2E,$EA

.L9591          LDA     #$04
                LDX     #$02
                JSR     OSBYTE

                LDA     #$DB
                LDX     #$8A
                JSR     OSBYTEwithY

                LDA     #$E3
                LDX     #$02
                JSR     OSBYTEwithY

                DEC     A
                LDX     #$02
                JSR     OSBYTEwithY

                LDX     #$02
.L95AE          DEC     A
.OSBYTEwithY    LDY     #$00
                JMP     OSBYTE

                LDA     #$DB
                LDX     #$09
                JSR     OSBYTEwithY

                LDA     #$04
                LDX     #$00
                JSR     OSBYTE

                LDA     #$E3
                LDX     #$90
                JSR     OSBYTEwithY

                DEC     A
                LDX     #$80
                JSR     OSBYTEwithY

                LDX     #$01
                BRA     L95AE

.L95D3          LDA     L0022
                CMP     GS
                LDA     L0023
                SBC     GS+1
                RTS

.ENDTES         CLC
                LDA     CURRLEN
                ADC     GE
                TAX
                LDA     #$00
                ADC     GE+1
                CPX     TMAX
                SBC     TMAX+1
                RTS

.LENGTH         LDY     #$00
.LECCLO         LDA     (GE),Y
                CMP     termin
                BEQ     LECCRE

                INY
                CPY     PAGEWI
                BNE     LECCLO

.LECCRE         TYA
                RTS

.CHECKR         STX     SIZE
                STY     SIZE+1
                SEC
                LDA     GE
.L9601          SBC     SIZE
L9602 = L9601+1
                TAX
                LDA     GE+1
                SBC     SIZE+1
                TAY
                STX     TEMP
                STY     TEMP+1
                CPX     GS
                SBC     GS+1
                BCS     VDU23X

                JMP     CHNRRE

.CURON          LDY     #$01
                BRA     VDU231

.L961A          LDY     #$00
.VDU231         LDX     #$01
                LDA     #$17
                JSR     L983C

                LDX     #$08
                LDA     #$00
.L9627          JSR     OSWRCH

                DEX
                BNE     L9627

.VDU23X         RTS

.L962E          LDA     options
                AND     #$07
                CMP     #$02
                BEQ     L9663

                CMP     #$05
                BEQ     L9663

                BRA     L966E

.L963C          LDA     options
                AND     #$07
                CMP     #$02
                BEQ     DOTUT

                CMP     #$05
                BNE     L966E

.DOTUT          PHA
                JSR     VSTRING

                INC     A
                ASL     L20EA,X
                BMI     L9602

                JSR     STARTI

                JSR     BIGMESS

                PLA
                CMP     #$02
                BEQ     KEYONLY

                JSR     BIGMET

.KEYONLY        JSR     L8C77

.L9663          JSR     LB01C

                JSR     GETWIN

                STA     REALPA
                JSR     DECWIN

.L966E          JSR     GETWIN

                TAX
                INX
                LDA     PAGEWI
.L9675          STA     L0732,X
                DEX
                BPL     L9675

                JSR     STATUS

                STZ     L0036
                RTS

.GETWIN         LDA     #$A0
                LDX     #$0A
                JSR     OSBYTE

                STX     PAGEWI
                STY     PAGELE
                LDX     #$08
                JSR     OSBYTE

                TYA
                CLC
                SBC     PAGELE
                STA     PAGELE
                RTS

.DECWIN         LDA     options
                AND     #$07
                LDY     #$0E
                CMP     #$05
                BEQ     WINDOW

                LDY     #$07
                CMP     #$02
                BNE     NOWIND

.WINDOW         JSR     VSTRING

                TRB     LEA00
                LDA     REALPA
                INC     A
                JSR     OSWRCH

                LDA     PAGEWI
                JMP     OSWRCHxtoa

.NOWIND         LDA     #$1A
                JMP     OSWRCH

.L96BE          LDA     NEXTREADFLAG
                BEQ     EDRDOSRD

                LDA     NEXTCHR
                STZ     NEXTREADFLAG
                BNE     L96CA

.L96C8          TSX
                RTS

.L96CA          LDX     L0080
                RTS

.EDRDOSRD       JSR     L8470

                TAX
.L96D1          BNE     L96DC

                JSR     L8470

                CMP     #$00
                BEQ     L96C8

                LDX     #$00
.L96DC          RTS

                LDA     #$81
                TAX
                LDY     #$03
                JSR     OSBYTE

                TYA
                BNE     L96EB

                TXA
                BRA     L96D1

.L96EB          JSR     L8473

                LDA     #$00
                TAX
                RTS

.MODIFY         LDA     #$01
                LDX     MODFLG
                STA     MODFLG
                CPX     #$01
                BNE     STATUS

                RTS

                LDA     #$10
                BRA     L9703

                LDA     #$08
.L9703          JSR     L8565

                STZ     UPDATE
.STATUS         JSR     CSROST

                JSR     LB030

                JSR     L8576

                BEQ     STATSO

                JSR     VSTRING

                EQUS    "Insert "

                EQUB    $EA

.L971E          BRA     STATSI

.STATSO         JSR     VSTRING

                EQUS    "Over   "

                EQUB    $EA

.STATSI         LDX     CURSED
                BEQ     VSTRNG

                JSR     VSTRING

                EQUS    "     Cursor Editing"

                EQUB    $EA

.L9746          BRA     STATSX

.VSTRNG         LDA     MARKX
                BEQ     STATST

                DEC     A
                BNE     STATSM

                JSR     VSTRING

                EQUS    "One mark "

                EQUB    $EA,$80,$31

.STATSM         JSR     VSTRING

                EQUS    "Two marks"

                EQUB    $EA,$80,$22

.STATST         LDA     #$08
                AND     options
                BNE     L9782

                JSR     VSTRING

                EQUS    "TAB cols "

                EQUB    $EA,$80,$0D

.L9782          JSR     VSTRING

                EQUS    "TAB words"

                EQUB    $EA,$A5,$2C,$3A,$30,$22,$D0,$10
                EQUB    $20,$32,$85

                EQUS    " Modified "

                EQUB    $EA,$80,$1E,$20,$32,$85

                EQUS    " Discarded"

                EQUB    $EA,$80,$0E,$20,$32,$85

                EQUS    " Original "

                EQUB    $EA

.STATSX         LDA     options
                AND     #$40
                BEQ     L97D3

                JSR     VSTRING

                EQUS    " LF"

                EQUB    $EA,$80,$07

.L97D3          JSR     VSTRING

                EQUS    " CR"

                EQUB    $EA,$A2,$1D,$8E,$E5,$07,$20,$1C
                EQUB    $B0,$A4,$31,$C8,$A9,$1C,$4C,$BE
                EQUB    $AE,$20,$FE,$97

                EQUS    "Type filename "

                EQUB    $EA,$80,$0E

.L97FE          LDY     PAGELE
                INY
                JSR     LAEB2

                LDX     #$00
                LDY     PAGELE
                INY
                JSR     L983A

                LDX     #$01
                BRA     L9812

.L9810          LDX     #$00
.L9812          JSR     LB030

                PLA
                STA     STRING
                PLA
                STA     STRING+1
                JSR     L8541

                JSR     LB01C

                TXA
                BEQ     L982C

                LDA     PAGEWI
                DEC     A
                LDY     PAGELE
                STA     L0733,Y
.L982C          JMP     (STRING)

.L982F          LDX     SCRNX
                LDY     L0038
                BPL     L983A

.CSROST         LDY     PAGELE
                INY
.L9838          LDX     #$00
.L983A          LDA     #$1F
.L983C          JSR     OSWRCH

                TXA
.OSWRCHxtoa     JSR     OSWRCH

                TYA
                JMP     OSWRCH

.NORMAL         LDA     GS
                STA     TEMP
                LDA     GS+1
                STA     TEMP+1
                JSR     L9862

                STA     STRING
                SEC
                LDA     GS
                SBC     STRING
                TAX
                LDA     GS+1
                SBC     #$00
                TAY
                JMP     GPBKXY

.L9862          CLC
                LDA     TEMP
                SBC     PAGEWI
                STA     TEMP
                BCS     L986D

                DEC     TEMP+1
.L986D          LDY     PAGEWI
.L986F          LDA     (TEMP),Y
                CMP     termin
                BEQ     L987A

.L9875          DEY
                BPL     L986F

                BMI     L9862

.L987A          STY     L002D
                SEC
                LDA     PAGEWI
                SBC     L002D
                RTS

.L9882          LDX     GE
                LDY     GE+1
                STX     L000E
                STY     L000F
.L988A          TAX
                STX     L002E
                BEQ     L98A8

.L988F          LDY     #$FF
.L9891          INY
                LDA     (L000E),Y
                CMP     termin
                BEQ     L989C

                CPY     PAGEWI
                BNE     L9891

.L989C          STA     L002D
                TYA
                JSR     L98A9

                BCS     L98A8

                DEC     L002E
                BNE     L988F

.L98A8          RTS

.L98A9          SEC
                ADC     L000E
                TAX
                LDA     #$00
                ADC     L000F
                TAY
                CPX     HIMEM
                SBC     HYMEM+1
                BCS     L98BC

                STX     L000E
                STY     L000F
.L98BC          RTS

.L98BD          LDX     GS
                LDY     GS+1
                STX     L000E
                STY     L000F
                TAX
                STX     L002E
                BEQ     L9905

                LDX     #$00
.L98CC          LDA     L0022
                CMP     L000E
                LDA     L0023
                SBC     L000F
                BCS     L9904

                CLC
                LDA     L000E
                SBC     PAGEWI
                STA     L000E
                BCS     L98E1

                DEC     L000F
.L98E1          LDY     PAGEWI
                LDA     (L000E),Y
                CMP     termin
                BNE     L98FF

                LDA     L000E
                STA     TEMP
                LDA     L000F
                STA     TEMP+1
                JSR     L9875

                BEQ     L98FF

                TYA
                ADC     L000E
                STA     L000E
                BCC     L98FF

                INC     L000F
.L98FF          INX
                CPX     L002E
                BCC     L98CC

.L9904          TXA
.L9905          RTS

.L9906          LDA     PAGELE
                INC     A
.L9909          JSR     L98BD

                LDX     L000E
                LDY     L000F
.GPBKXY         STX     ARGP
                STY     ARGP+1
                SEC
                LDA     GS
                SBC     ARGP
                STX     GS
                TAX
                LDA     GS+1
                SBC     ARGP+1
                STY     GS+1
                TAY
                STX     SIZE
                STY     SIZE+1
                LDA     GE
                SBC     SIZE
                STA     VARP
                STA     GE
                LDA     GE+1
                SBC     SIZE+1
                STA     VARP+1
                STA     GE+1
                STX     SIZE
                STY     SIZE+1
.CPFD2          LDA     SIZE
                TAY
                ORA     SIZE+1
                BEQ     L9964

                LDX     SIZE+1
                CLC
                TXA
                ADC     ARGP+1
                STA     ARGP+1
                TXA
                ADC     VARP+1
                STA     VARP+1
                INX
                BCC     L9956

.L9952          LDA     (ARGP),Y
                STA     (VARP),Y
.L9956          DEY
                CPY     #$FF
                BNE     L9952

                DEX
                BEQ     L9964

                DEC     ARGP+1
                DEC     VARP+1
                BNE     L9952

.L9964          RTS

                LDA     PAGELE
                INC     A
.L9968          JSR     L9882

.L996B          LDX     L000E
                LDY     L000F
.L996F          LDA     GE
                STA     ARGP
                LDA     GE+1
                STA     ARGP+1
                LDA     GS
                STA     VARP
                LDA     GS+1
                STA     VARP+1
                SEC
                TXA
                SBC     GE
                TAX
                TYA
                SBC     GE+1
                TAY
                CLC
                TXA
                ADC     GS
                STA     GS
                TYA
                ADC     GS+1
                STA     GS+1
                TXA
                ADC     GE
                STA     GE
                TYA
                ADC     GE+1
                STA     GE+1
                JMP     L84AF

.FINEPO         JSR     L99B0

                CLC
                LDA     GE
                ADC     SCRNX
                TAX
                LDA     GE+1
                ADC     #$00
                TAY
                BRA     L996F

.L99B0          JSR     L99D4

                BEQ     L99D1

                PHA
                TAX
                LDA     CURRLEN
                JSR     L99DE

                LDX     CURRLEN
                LDY     L0038
                JSR     L983A

                LDA     #$20
                JSR     OSWRCH

                PLX
                LDY     SCRNX
.L99CB          DEY
                STA     (GE),Y
                DEX
                BNE     L99CB

.L99D1          JMP     L982F

.L99D4          SEC
                LDA     SCRNX
                SBC     CURRLEN
                BCS     L99DD

                LDA     #$00
.L99DD          RTS

.L99DE          STA     L002D
                CLC
                ADC     GE
                PHA
                LDA     GE+1
                ADC     #$00
                PHA
                PHX
                LDY     #$00
                JSR     CHECKR

                LDY     #$00
.L99F1          LDA     (GE),Y
                STA     (TEMP),Y
                INY
                CPY     L002D
                BCC     L99F1

                STX     GE
                LDA     TEMP+1
                STA     GE+1
                PLX
                STX     L002E
                PLA
                STA     TEMP+1
                PLA
                STA     TEMP
                LDY     MARKX
.L9A0B          DEY
                BMI     L9A2A

                LDX     SMATLO,Y
                CPX     TEMP
                LDA     SMATHI,Y
                SBC     TEMP+1
                BCS     L9A0B

                SEC
                TXA
                SBC     L002E
                STA     SMATLO,Y
                LDA     SMATHI,Y
                SBC     #$00
                STA     SMATHI,Y
                BRA     L9A0B

.L9A2A          RTS

                LDA     #$08
                BIT     options
                BNE     L9A43

.L9A31          INC     SCRNX
                LDA     SCRNX
                AND     #$07
                BNE     L9A31

                LDA     SCRNX
                CMP     PAGEWI
                BCC     L9A6F

                STZ     SCRNX
                BRA     L9A6F

.L9A43          LDA     #$01
                JSR     L98BD

                CMP     #$01
                BNE     L9A2A

                LDY     SCRNX
                DEY
.L9A4F          INY
                CPY     PAGEWI
                BCS     L9A60

                LDA     (L000E),Y
                CMP     termin
                BEQ     L9A60

                CMP     #$20
                BNE     L9A4F

                BRA     L9A62

.L9A60          LDY     #$FF
.L9A62          INY
                CPY     PAGEWI
                BCS     L9A6D

                LDA     (L000E),Y
                CMP     #$20
                BEQ     L9A62

.L9A6D          STY     SCRNX
.L9A6F          STZ     UPDATE
.RELANX         RTS

                JSR     L97FE

                EQUS    "Type language name:"

                EQUB    $EA

.L9A89          JSR     READLS

                BEQ     RELANX

                LDY     #$00
.RELAPL         LDA     LINBUFF,Y
                INY
                CMP     #$0D
                BNE     RELAPL

                STA     LINBUFF+1,Y
                LDA     #$20
                STA     L04FF,Y
                LDA     #$40
                STA     LINBUFF,Y
                LDA     #$06
                STA     UPDATE
                JSR     STFILE

                LDA     GE+1
                DEC     A
                CMP     PAJE+1
                BCS     RETLOK

                BRK
                EQUB    $02

                EQUS    "Not enough space to return to language"

                EQUB    $00

.RETLOK         LDA     #$FF
                STA     BRKACT
                LDA     PAJE+1
                INC     A
                STA     ARGP+1
                STZ     ARGP
                LDA     #$00
                STA     (TMAX)
                LDA     GE
                STA     ADDR
                LDA     GE+1
                STA     ADDR+1
.RELLOP         LDA     (ADDR)
                STA     (ARGP)
                INC     ARGP
                BNE     L9AFD

                INC     ARGP+1
.L9AFD          INC     ADDR
                BNE     RELLOP

                INC     ADDR+1
                LDA     ADDR+1
                CMP     HYMEM+1
                BNE     RELLOP

                JSR     CURON

                JSR     VSTRING

                INC     A
                TSB     L20EA
                LDY     L0095,X
                LDA     PAJE+1
                INC     A
                STA     STRING+1
                STZ     STRING
                LDX     #$00
                LDY     #$05
                JMP     OSCLI

                JSR     LA0FE

                ASL     L0D0D
                EQUS    "Format commands:- {initial values}"

                EQUB    $0D,$83

                EQUS    "afrn assign format n to register r {0}"

                EQUB    $83

                EQUS    "anrn assign number to register r {0}"

                EQUB    $83,$62,$6C,$81

                EQUS    "bold"

                EQUB    $84,$83,$62,$70,$81

                EQUS    "begin"

                EQUB    $85,$83

                EQUS    "cc c control"

                EQUB    $86

                EQUS    "is c {.}"

                EQUB    $83,$63,$65,$81

                EQUS    "centre"

                EQUB    $84,$83

                EQUS    "ch*c chain in next file"

                EQUB    $83,$63,$6F,$81

                EQUS    "comment"

                EQUB    $84,$83

                EQUS    "dmcc define macro to .en"

                EQUB    $83,$64,$73,$81

                EQUS    "double space"

                EQUB    $84,$73,$83,$65,$66,$81,$8F,$85

                EQUS    "foot"

                EQUB    $80,$65,$68,$81,$8F,$85

                EQUS    "head"

                EQUB    $80,$65,$6E,$81

                EQUS    "end of .at, .ix or .ef etc"

                EQUB    $83,$65,$70,$81

                EQUS    "begin "

                EQUB    $8F,$85,$83,$66,$66,$81

                EQUS    "form feed"

                EQUB    $93

                EQUS    "printer, wait if paged mode"

                EQUB    $83,$66,$6F,$81,$8F

                EQUS    " and odd foot"

                EQUB    $80,$68,$65,$81,$8F

                EQUS    " and odd head"

                EQUB    $80,$69,$63,$81

                EQUS    "close indexfile"

                EQUB    $83,$69,$67,$81

                EQUS    "ignore input until .en"

                EQUB    $83

                EQUS    "in+- indent left margin n places {0}"

                EQUB    $83

                EQUS    "io*c open indexfile for output"

                EQUB    $83,$69,$78,$81

                EQUS    "send"

                EQUB    $88

                EQUS    "to indexfile until .en"

                EQUB    $83,$6A,$75,$81

                EQUS    "justify right margin of"

                EQUB    $84

                EQUS    "s {on}"

                EQUB    $83

                EQUS    "ll+-"

                EQUB    $84

                EQUS    " length including indent {76}"

                EQUB    $83

                EQUS    "ls+-"

                EQUB    $84

                EQUS    " spacing is n {1}"

                EQUB    $83

                EQUS    "lv n leave n blank"

                EQUB    $84

                EQUS    "s (by .ne n and .sp n)"

                EQUB    $83

                EQUS    "ne n n"

.L9DC3          EQUS    "eeds n output"

                EQUB    $84

                EQUS    "s, .bp if necessary"

                EQUB    $83,$6E,$6A,$81

                EQUS    "no justification of"

                EQUB    $84,$73,$83,$6E,$6E,$81

                EQUS    "no new"

                EQUB    $84

                EQUS    " after this"

                EQUB    $84,$83,$6F,$66,$81

                EQUS    "odd"

                EQUB    $85

                EQUS    "foot"

                EQUB    $80,$6F,$68,$81

                EQUS    "odd"

                EQUB    $85

                EQUS    "head"

                EQUB    $80,$6F,$70,$81

                EQUS    "begin odd"

                EQUB    $85,$83

                EQUS    "os*c call operating system with this string"

                EQUB    $83

                EQUS    "pl+-"

                EQUB    $88

                EQUS    "area length is n"

                EQUB    $84,$73,$20,$7B,$35,$38,$7D,$83

                EQUS    "po+-"

                EQUB    $85

                EQUS    "offset is n {0}"

                EQUB    $83,$72,$66,$81

                EQUS    "right flush this"

                EQUB    $84,$83

                EQUS    "sp n insert n blank"

                EQUB    $84,$73,$83,$73,$73,$81

                EQUS    "single space"

                EQUB    $84,$73,$83,$74,$61,$81

                EQUS    "define tabs {8,16,24,...,96}"

                EQUB    $83

                EQUS    "tcc  define tab"

                EQUB    $86

                EQUS    "as c {ctrl I}"

                EQUB    $83

                EQUS    "ti+- temporary indent n"

                EQUB    $83

                EQUS    "trcc translate {NBSP is space}"

                EQUB    $83,$75,$6C,$81

                EQUS    "underline"

                EQUB    $84,$0D,$0D

                EQUS    "n represents a decimal number, 0 is used if not present"

                EQUB    $0D

                EQUS    "Spaces are allowed before n. c represents any"

                EQUB    $86,$0D

                EQUS    "+- allows n, +n or -n: .in+2 sets an indent 2 more than current"

                EQUB    $83

                EQUS    "ti+2 is a temporary indent of 2 more than"

                EQUB    $93

                EQUS    "current indent"

                EQUB    $0D,$0D

                EQUS    "Formatting commands which can appear anywhere"

                EQUB    $0D,$83,$62,$62,$81

                EQUS    "begin bold"

                EQUB    $83,$62,$75,$81

                EQUS    "begin underline"

                EQUB    $83,$65,$62,$81

                EQUS    "end bold"

                EQUB    $83,$65,$75,$81

                EQUS    "end underline"

                EQUB    $83,$6F,$63,$82

                EQUS    "counted as 1"

                EQUB    $86,$83,$6F,$6E,$82

                EQUS    "without being counted"

                EQUB    $83

                EQUS    "r0-9 contents of register e.g. .r0"

                EQUB    $0F,$0D,$0D,$EA,$20,$05,$AC,$4C
                EQUB    $87,$85

.LA0FE          PLA
                STA     L007B
                PLA
                STA     L007C
                JSR     LA10D

                JMP     (L007B)

.LA10A          JSR     LA11A

.LA10D          INC     L007B
                BNE     LA113

                INC     L007C
.LA113          LDA     (L007B)
                CMP     #$EA
                BNE     LA10A

                RTS

.LA11A          CMP     #$A0
                BCS     LA122

                CMP     #$80
                BCS     LA125

.LA122          JMP     OSASCI

.LA125          PHY
                PHX
                LDY     #$FF
                EOR     #$80
                TAX
                BEQ     LA137

.LA12E          INY
                LDA     LA145,Y
                BNE     LA12E

                DEX
                BNE     LA12E

.LA137          INY
                LDA     LA145,Y
                BEQ     LA142

                JSR     LA11A

                BRA     LA137

.LA142          PLX
                PLY
                RTS

.LA145          JSR     L6974

                EQUS    "title"

                EQUB    $92

                EQUS    ".en"

                EQUB    $83,$00,$20,$20,$20,$00

                EQUS    " n output CHR$(n)"

                EQUB    $92

                EQUS    "printer "

                EQUB    $00,$0D,$2E,$00

                EQUS    " line"

                EQUB    $00

                EQUS    " page "

                EQUB    $00

                EQUS    " character "

                EQUB    $00

                EQUS    "shf-f"

                EQUB    $00

                EQUS    " text "

                EQUB    $00

                EQUS    " marked "

                EQUB    $00

                EQUS    "RETURN"

                EQUB    $00,$2E,$0D,$8A

                EQUS    " uses"

                EQUB    $93

                EQUS    "name at the start of"

                EQUB    $88

                EQUS    "after a '>'"

                EQUB    $0D

                EQUS    "COPY, "

                EQUB    $8A,$92

                EQUS    "use"

                EQUB    $93

                EQUS    "current file name."

                EQUB    $00

                EQUS    "The "

                EQUB    $00,$32,$0D,$41,$88

                EQUS    "file will be loaded"

                EQUB    $00

                EQUS    "text"

                EQUB    $00

                EQUS    "even"

                EQUB    $00

                EQUS    " scroll margins "

                EQUB    $00,$90

                EQUS    "with ctrl-f"

                EQUB    $00

                EQUS    " to "

                EQUB    $00

                EQUS    " the "

                EQUB    $00,$48,$4A,$4A,$4A,$4A,$20,$4B
                EQUB    $A2,$68,$29,$0F,$F8,$C9,$0A,$69
                EQUB    $30,$D8,$4C,$EE,$FF,$20,$5D,$B1
                EQUB    $20,$6C,$A9,$20,$75,$A9,$A9,$02
                EQUB    $85,$24,$20,$73,$84,$B2,$0E,$C5
                EQUB    $81,$D0,$02,$A9,$0D,$20,$E3,$FF
                EQUB    $A9,$00,$20,$A9,$98,$90,$EB,$A9
                EQUB    $03,$20,$EE,$FF,$4C,$87,$85,$4C
                EQUB    $23,$9B,$20,$6D,$BC,$A2,$FF,$86
                EQUB    $29,$86,$2A,$86,$45,$9A,$20,$FE
                EQUB    $97

                EQUS    "Screen, Printer, As is, Help ?"

                EQUB    $EA,$20,$2F,$BA,$C9,$61,$F0,$9E
                EQUB    $C9,$68,$F0,$C4,$C9,$73,$F0,$06
                EQUB    $C9,$70,$D0,$ED,$64,$2A,$20,$FE
                EQUB    $97

                EQUS    "Continuous, Paged ?"

                EQUB    $EA,$20,$2F,$BA,$C9,$63,$F0,$06
                EQUB    $C9,$70,$D0,$F5,$64,$29

.LA2EA          JSR     L84EB

                LDA     L0022
                STA     ADDR
                LDA     L0023
                STA     ADDR+1
                LDA     #$2E
                STA     L0046
                LDX     #$00
.LA2FB          STZ     LINBUFF,X
                INX
                TXA
                STA     L0600,X
                BNE     LA2FB

                LDA     #$20
                STA     L06A0
                LDY     termin
                CPY     #$0D
                BNE     LA315

                STA     L060A
                BRA     LA318

.LA315          STA     L060D
.LA318          LDA     #$09
                STA     mark_count
                DEC     A
                CLC
.LA31E          STA     L051C,X
                INX
                ADC     #$08
                CMP     #$64
                BCC     LA31E

                LDA     #$02
                STA     BRKACT
                DEC     A
                STA     LINBUFF
                STA     UMATHI+1
                STA     L0502
                STZ     LINE
                STZ     L004E
                STZ     UMATLO+1
                STZ     L004A
                STZ     SMATHI+1
                STZ     L003B
                STZ     L0049
                STZ     SMATLO+1
                LDA     #$3A
                STA     L0044
                LDA     #$4C
                STA     SMATHI
                JSR     VSTRING

                INC     A
                TSB     L24EA
                ROL     A
                BMI     LA35A

                JSR     LA975

.LA35A          BIT     L0029
                BMI     LA367

                BIT     L002A
                BPL     LA367

                LDA     #$0E
                JSR     OSWRCH

.LA367          LDA     termin
                STA     (GS)
                LDX     #$98
                LDY     #$A0
                CMP     #$0D
                BEQ     LA377

                LDX     #$B8
                LDY     #$C0
.LA377          STX     L0514
                STX     L0516
                STY     L0518
                STY     L051A
                LDY     #$BE
                STY     L0515
                STY     L0517
                STY     L0519
                STY     L051B
                LDX     #$D0
.LA393          STZ     L052F,X
                DEX
                BNE     LA393

.LA399          STZ     L0017
                STZ     SMATLO
                LDA     #$FF
                STA     L003C
                LDA     UMATLO+1
                STA     UMATLO
                STA     L0048
                LDA     L004A
                STA     UMATHI
                STA     L0047
                BRA     LA3F5

.LA3AF          JSR     LA82F

                BIT     L002A
                BPL     LA3C9

                JSR     L9810

                BVC     LA42D

                ADC     #$6E
                STZ     HIMEM,X
                STZ     L006F
                ROR     L2E65
                JSR     L20EA

                ORA     L00AC
.LA3C9          JSR     VSTRING

                NOP
                JSR     LABDA

                LDX     GS
                LDY     GS+1
                JMP     L8584

.LA3D9          LDY     #$03
                JSR     LA5FF

.LA3DE          JSR     LA51B

                DEY
                CLC
                JSR     LA8E4

                LDA     (ADDR)
                CMP     L0046
                BEQ     LA405

                LDY     #$00
.LA3EE          JSR     LA7DE

                SEC
                JSR     LA8E4

.LA3F5          LDA     ADDR+1
                STA     L0014
                CMP     #$A3
                BCS     LA405

                LDX     ADDR
                CPX     GS
                SBC     GS+1
                BCS     LA3AF

.LA405          LDA     (ADDR)
                CMP     L0046
                BNE     LA456

                LDX     #$00
                LDY     #$02
                LDA     (ADDR),Y
                STA     TEMP+1
                DEY
                LDA     (ADDR),Y
.LA416          CMP     LAD53,X
                BNE     LA422

                LDY     LAD54,X
                CPY     TEMP+1
                BEQ     LA3D9

.LA422          INX
                INX
                INX
                INX
                CPX     #$AC
                BNE     LA416

                JSR     LA6C8

.LA42D          BCC     LA456

                LDA     ADDR
                PHA
                LDA     ADDR+1
                PHA
                LDA     L0046
                PHA
                LDA     (L006B)
                STA     L0046
                LDA     L006B
                STA     ADDR
                LDA     L006C
                STA     ADDR+1
                LDY     #$02
                JSR     LA3EE

                PLA
                STA     L0046
                PLA
                STA     ADDR+1
                PLA
                STA     ADDR
                LDY     #$03
                BRA     LA3DE

.LA456          LDA     L0045
                INC     A
                BNE     LA45E

                JSR     LA946

.LA45E          LDA     SMATHI
                LDY     L003C
                INY
                SEC
                BEQ     LA46A

                SBC     L003C
                BRA     LA46C

.LA46A          SBC     SMATHI+1
.LA46C          STA     L003D
                LDY     #$00
                LDX     #$00
                STZ     L003E
                STZ     L004B
.LA476          CPY     #$FA
                BCS     LA4D3

                JSR     LA525

                CMP     termin
                BEQ     LA4D3

                CMP     mark_count
                BNE     LA4AB

                TXA
                LDX     #$FF
.LA488          INX
                PHA
                LDA     L051C,X
                BEQ     LA4A8

                PLA
                CMP     L051C,X
                BCS     LA488

                PHA
                LDA     L051C,X
                PLX
                INY
                CMP     L003D
                BCS     LA4B9

                TAX
                STX     L0015
                STX     L004B
                STZ     L003E
                BRA     LA4B5

.LA4A8          PLX
                LDA     #$20
.LA4AB          CMP     #$20
                BNE     LA4B3

                STX     L0015
                INC     L003E
.LA4B3          INX
                INY
.LA4B5          CPX     L003D
                BCC     LA476

.LA4B9          JSR     LA525

                CMP     #$20
                BEQ     LA4D0

                CMP     mark_count
                BEQ     LA4D0

                CMP     termin
                BEQ     LA4D0

                LDA     L003E
                BEQ     LA4D0

                LDX     L0015
                DEC     L003E
.LA4D0          DEX
                STZ     L0014
.LA4D3          INX
                STX     L002E
                BIT     L002A
                BPL     LA4DF

                JSR     LAB15

                BRA     LA4F9

.LA4DF          LDA     #$40
                TSB     L002A
                LDA     UMATLO
                PHA
                JSR     LAAF8

                PLA
                STA     UMATLO
                BIT     L0048
                BPL     LA4F9

                LDA     #$40
                TRB     L002A
                JSR     LAB15

                STZ     UMATLO
.LA4F9          BIT     SMATLO+1
                BMI     LA50A

                LDX     UMATHI+1
.LA4FF          JSR     LAAB9

                LDA     L0045
                INC     A
                BEQ     LA50A

                DEX
                BNE     LA4FF

.LA50A          STZ     SMATLO+1
                JSR     LA51B

                CMP     termin
                BEQ     LA514

                DEY
.LA514          CLC
                JSR     LA8E4

                JMP     LA399

.LA51B          LDA     (ADDR),Y
                INY
                BEQ     LA524

                CMP     #$20
                BEQ     LA51B

.LA524          RTS

.LA525          LDA     (ADDR),Y
                CMP     L0046
                BNE     LA574

                INY
                LDA     (ADDR),Y
                CMP     #$62
                BEQ     LA53E

                CMP     #$6F
                BEQ     LA54C

                CMP     #$72
                BEQ     LA560

                CMP     #$65
                BNE     LA571

.LA53E          INY
                LDA     (ADDR),Y
                CMP     #$62
                BEQ     LA549

                CMP     #$75
                BNE     LA570

.LA549          INY
                BRA     LA525

.LA54C          INY
                LDA     (ADDR),Y
                CMP     #$6E
                BEQ     LA558

                CMP     #$63
                BNE     LA570

                INX
.LA558          PHX
                INY
                JSR     LA91C

                PLX
                BRA     LA525

.LA560          INY
                LDA     (ADDR),Y
                CMP     #$30
                BCC     LA570

                CMP     #$3A
                BCS     LA570

                JSR     LAC3C

                BRA     LA549

.LA570          DEY
.LA571          DEY
                LDA     (ADDR),Y
.LA574          RTS

.LA575          INY
.LA576          LDA     (ADDR),Y
                CMP     L0046
                BNE     LA574

                INY
                LDA     (ADDR),Y
                CMP     #$62
                BEQ     LA5A6

                CMP     #$6F
                BEQ     LA5C5

                CMP     #$72
                BEQ     LA5E2

                CMP     #$65
                BNE     LA571

                INY
                LDA     (ADDR),Y
                CMP     #$62
                BEQ     LA5A0

                CMP     #$75
                BNE     LA570

                STZ     UMATLO+1
                STZ     UMATLO
                BRA     LA575

.LA5A0          STZ     L004A
                STZ     UMATHI
                BRA     LA575

.LA5A6          INY
                LDA     (ADDR),Y
                CMP     #$62
                BEQ     LA5BB

                CMP     #$75
                BNE     LA570

                LDA     #$FF
                STA     UMATLO
                STA     UMATLO+1
                STA     L0048
                BRA     LA575

.LA5BB          LDA     #$FF
                STA     L004A
                STA     L0047
                STA     UMATHI
                BRA     LA575

.LA5C5          INY
                LDA     (ADDR),Y
                CMP     #$6E
                BEQ     LA5D1

                CMP     #$63
                BNE     LA570

                INX
.LA5D1          PHX
                INY
                JSR     LA91C

                LDA     #$01
                JSR     OSWRCH

                TXA
                JSR     OSWRCH

                PLX
                BRA     LA576

.LA5E2          INY
                LDA     (ADDR),Y
                CMP     #$30
                BCC     LA570

.LA5E9          CMP     #$3A
LA5EA = LA5E9+1
                BCS     LA570

                JSR     LAC3C

                PHX
                LDX     TEMP
.LA5F3          LDA     L006B,X
                JSR     LAA71

                DEX
                BPL     LA5F3

                PLX
                JMP     LA575

.LA5FF          LDA     #$FF
                JMP     (LAD55,X)
                JSR     LA91C

                AND     #$0F
                ASL     A
                TAX
                LDA     LINBUFF+1,X
                AND     #$0F
                STA     LINBUFF+1,X
                INY
                PHX
                JSR     LA91C

                PLX
                ASL     A
                ASL     A
                ASL     A
                ASL     A
                ORA     LINBUFF+1,X
                STA     LINBUFF+1,X
                RTS

.LA624          JSR     LA91C

                AND     #$0F
                ASL     A
                PHA
                LDA     (ADDR),Y
                INY
                PHA
                JSR     LA91C

                PLA
                CMP     #$2B
                BEQ     LA64D

                CMP     #$2D
                BEQ     LA662

                CMP     #$3D
                BEQ     LA676

                TXA
                PLX
                STA     LINBUFF,X
                LDA     LINBUFF+1,X
                AND     #$F0
                STA     LINBUFF+1,X
                RTS

.LA64D          CLC
                STX     L006B
                PLX
                LDA     LINBUFF,X
                ADC     L006B
                STA     LINBUFF,X
                LDA     LINBUFF+1,X
                ADC     #$00
                STA     LINBUFF+1,X
                RTS

.LA662          STX     L006B
                PLX
                LDA     LINBUFF,X
                SBC     L006B
                STA     LINBUFF,X
                LDA     LINBUFF+1,X
                SBC     #$00
                STA     LINBUFF+1,X
                RTS

.LA676          TXA
                AND     #$0F
                ASL     A
                TAX
                LDA     LINBUFF+1,X
                AND     #$0F
                STA     L006B
                LDA     LINBUFF,X
                PLX
                STA     LINBUFF,X
                LDA     LINBUFF+1,X
                AND     #$F0
                ORA     L006B
                STA     LINBUFF+1,X
                RTS

.LA694          STA     UMATHI
                STA     L0047
                RTS

                LDA     (ADDR),Y
                STA     L0046
                INY
                RTS

                STA     L0017
                STZ     SMATLO
                RTS

                LDA     ADDR
                STA     TEMP
                LDA     ADDR+1
                STA     TEMP+1
                LDA     L0022
                STA     ADDR
                LDA     L0023
                STA     ADDR+1
                LDA     TMAX
                LDX     TMAX+1
                JSR     L82AE

                JSR     getfilesys

                STX     GS
                STY     GS+1
                LDX     #$FF
                TXS
                JMP     LA367

.LA6C8          STA     TEMP
                LDX     #$FE
.LA6CC          INX
                INX
                CPX     #$D0
                BCS     LA6F8

                LDA     L0530,X
                STA     L006B
                LDA     L0531,X
                STA     L006C
                BEQ     LA6FA

                PHY
                LDY     #$03
.LA6E1          LDA     (L006B),Y
                INY
                CMP     #$20
                BEQ     LA6E1

                STA     L006D
                LDA     (L006B),Y
                PLY
                CMP     TEMP+1
                BNE     LA6CC

                LDA     L006D
                CMP     TEMP
                BNE     LA6CC

                RTS

.LA6F8          CLC
                TXA
.LA6FA          RTS

.LA6FB          DEY
                RTS

.LA6FD          JSR     LA51B

                CMP     termin
                BEQ     LA6FB

                CMP     L0046
                BEQ     LA6FB

                STA     TEMP+1
                LDA     (ADDR),Y
                CMP     termin
                BEQ     LA6FB

                JSR     LA6C8

                BNE     LA6FB

                LDA     ADDR
                STA     L0530,X
                LDA     ADDR+1
                STA     L0531,X
                BRA     LA768

                LDA     #$02
                STA     UMATHI+1
                RTS

                LDA     ADDR
                STA     L051A
                LDA     ADDR+1
                STA     L051B
                BRA     LA768

                LDA     ADDR
                STA     L0516
                LDA     ADDR+1
                STA     L0517
                BRA     LA768

                LDA     ADDR
                STA     L051A
                LDA     ADDR+1
                STA     L051B
                LDA     ADDR
                STA     L0518
                LDA     ADDR+1
                STA     L0519
                BRA     LA768

                LDA     ADDR
                STA     L0516
                LDA     ADDR+1
                STA     L0517
                LDA     ADDR
                STA     L0514
                LDA     ADDR+1
                STA     L0515
.LA768          CLC
                JSR     LA8E4

.LA76C          LDA     (ADDR)
                INC     ADDR
                BNE     LA780

                PHA
                INC     ADDR+1
                LDA     ADDR
                CMP     GS
                LDA     ADDR+1
                SBC     GS+1
                BCS     LA793

                PLA
.LA780          CMP     L0046
                BNE     LA76C

                LDA     (ADDR)
                CMP     #$65
                BNE     LA76C

                LDY     #$01
                LDA     (ADDR),Y
                CMP     #$6E
                BNE     LA76C

                INY
.LA793          RTS

.LA794          TSX
                CPX     #$FD
                BCS     LA793

                PLA
                PLA
                RTS

.LA79C          JSR     LA82F

                LDA     LINBUFF
                LSR     A
                BCS     LA79C

                RTS

                LDA     L0029
                BMI     LA7B1

                LDA     L002A
                BPL     LA7B6

                JSR     LAC20

.LA7B1          LDA     #$0C
                JMP     OSWRCH

.LA7B6          JSR     LA7B1

                JMP     LAC20

                PHY
                JSR     LABDA

                PLY
                RTS

                LDX     SMATHI+1
                JSR     LA8EE

                STX     SMATHI+1
                RTS

                CLC
                JSR     LA8E4

                JSR     LABDA

                LDX     ADDR
                LDY     ADDR+1
                LDA     #$80
                JSR     OSFIND

                STA     L004E
                LDY     #$00
.LA7DE          LDA     termin
                BRA     LA7E7

.LA7E2          INY
                BNE     LA7E7

                INC     ADDR+1
.LA7E7          CMP     (ADDR),Y
                BNE     LA7E2

                RTS

                STA     LINE
                CLC
                JSR     LA8E4

                LDA     L0045
                PHA
                LDA     #$FD
                STA     L0045
                JSR     LA3F5

                PLA
                STA     L0045
                STZ     LINE
                RTS

                STZ     L003B
                RTS

                LDX     SMATHI
                JSR     LA8EE

                STA     SMATHI
                RTS

                LDX     UMATHI+1
                JSR     LA8EE

                STX     UMATHI+1
                RTS

                JSR     LA91C

                CMP     L0045
                BEQ     LA823

                BCC     LA823

                PHA
                JSR     LA82F

                PLA
.LA823          JMP     LA875

                JSR     LA91C

                CMP     L0045
                BEQ     LA835

                BCC     LA835

.LA82F          LDA     L0045
                BRA     LA875

                STA     L003B
.LA835          RTS

                STA     SMATLO+1
                RTS

.LA839          JSR     LA82F

                LDA     LINBUFF
                LSR     A
                BCC     LA839

                RTS

                CLC
                JSR     LA8E4

                LDX     ADDR
                LDY     ADDR+1
                JSR     OSCLI

                LDY     #$00
                JMP     LA7DE

                LDX     L0044
                JSR     LA8EE

                TXA
                BEQ     LA864

                STA     L0044
                LDX     L0045
                INX
                BEQ     LA864

                STA     L0045
.LA864          RTS

                LDX     L0049
                JSR     LA8EE

                STA     L0049
                RTS

                STA     SMATLO
                STZ     L0017
                RTS

                JSR     LA91C

.LA875          TAX
                BEQ     LA898

                PHY
                CMP     #$FF
                BNE     LA882

                JSR     LA946

                LDX     L0045
.LA882          LDA     L0045
                INC     A
                BNE     LA88C

                PHX
                JSR     LA946

                PLX
.LA88C          LDA     #$0D
                JSR     OSWRCH

                JSR     LAAB9

                DEX
                BNE     LA882

                PLY
.LA898          RTS

                LDA     #$01
                STA     UMATHI+1
                RTS

                STZ     L004B
.LA8A0          JSR     LA91C

                LDX     L004B
                STA     L051C,X
                STZ     L051D,X
                INC     L004B
                JSR     LA51B

                CMP     #$2C
                BEQ     LA8A0

                DEY
                RTS

                LDA     (ADDR),Y
                STA     mark_count
                INY
                RTS

                LDX     L003C
                CPX     #$FF
                BNE     LA8C4

                LDX     SMATHI+1
.LA8C4          JSR     LA8EE

                STX     L003C
                RTS

                LDA     (ADDR),Y
                CMP     termin
                BEQ     LA8DE

                TAX
                INY
                LDA     (ADDR),Y
                DEY
                CMP     termin
                BEQ     LA8DE

                INY
                INY
                STA     L0600,X
.LA8DE          RTS

                STA     UMATLO
                STA     L0048
                RTS

.LA8E4          TYA
                ADC     ADDR
                STA     ADDR
                BCC     LA8ED

                INC     ADDR+1
.LA8ED          RTS

.LA8EE          JSR     LA51B

                CMP     #$2D
                BEQ     LA90C

                CMP     #$2B
                BEQ     LA8FC

                DEY
                LDX     #$00
.LA8FC          PHX
                JSR     LA91C

                PLX
                CLC
                STX     TEMP
                ADC     TEMP
                BCC     LA90A

                LDA     #$00
.LA90A          TAX
                RTS

.LA90C          PHX
                JSR     LA91C

                STA     TEMP
                PLA
                SEC
                SBC     TEMP
                BCS     LA90A

                LDA     #$00
                TAX
                RTS

.LA91C          LDX     #$00
                JSR     LA51B

                DEY
.LA922          LDA     (ADDR),Y
                CMP     #$30
                BCC     LA944

                CMP     #$3A
                BCS     LA943

                AND     #$0F
                PHA
                TXA
                ASL     A
                ASL     A
                STA     TEMP
                TXA
                CLC
                ADC     TEMP
                ASL     A
                STA     TEMP
                PLA
                CLC
                ADC     TEMP
                TAX
                INY
                BRA     LA922

.LA943          CLC
.LA944          TXA
                RTS

.LA946          LDX     L0514
                LDY     L0515
                LDA     LINBUFF
                LSR     A
                BCC     LA958

                LDX     L0516
                LDY     L0517
.LA958          DEC     L0045
                JSR     LA984

                LDA     L0044
                STA     L0045
                LDA     #$01
                STA     L0502
                LDA     #$0F
                TRB     L0503
                RTS

.LA96C          LDA     GE
                STA     L000E
                LDA     GE+1
                STA     L000F
                RTS

.LA975          LDA     #$05
                LDX     #$00
                JSR     OSBYTE

                JSR     OSBYTE

                LDA     #$02
                JMP     OSWRCH

.LA984          LDA     ADDR
                PHA
                LDA     ADDR+1
                PHA
                LDA     L0046
                PHA
                LDA     SMATHI
                PHA
                LDA     SMATHI+1
                PHA
                LDA     L003C
                PHA
                LDA     UMATHI
                PHA
                LDA     L004A
                PHA
                LDA     L0047
                PHA
                LDA     UMATLO
                PHA
                LDA     UMATLO+1
                PHA
                LDA     L0048
                PHA
                LDA     L003B
                PHA
                LDA     UMATHI+1
                PHA
                LDA     L0017
                PHA
                LDA     SMATLO
                PHA
                LDA     SMATLO+1
                PHA
                STZ     SMATLO+1
                STZ     L003B
                STZ     L004A
                STZ     UMATLO+1
                STZ     SMATHI+1
                LDA     #$01
                STA     UMATHI+1
                STX     ADDR
                STY     ADDR+1
                LDA     (ADDR)
                STA     L0046
                LDY     #$03
                CLC
                JSR     LA8E4

                JSR     LA399

                PLA
                STA     SMATLO+1
                PLA
                STA     SMATLO
                PLA
                STA     L0017
                PLA
                STA     UMATHI+1
                PLA
                STA     L003B
                PLA
                STA     L0048
                PLA
                STA     UMATLO+1
                PLA
                STA     UMATLO
                PLA
                STA     L0047
                PLA
                STA     L004A
                PLA
                STA     UMATHI
                PLA
                STA     L003C
                PLA
                STA     SMATHI+1
                PLA
                STA     SMATHI
                PLA
                STA     L0046
                PLA
                STA     ADDR+1
                PLA
                STA     ADDR
                RTS

.LAA0A          TAY
                LDA     L0600,Y
                STA     addrpointer
                JSR     addreadfrom

                LDA     #$0A
                JMP     OSWORD

.LAA18          BIT     UMATHI
                BPL     LAA33

                PHY
                PHX
                JSR     LAA0A

                LDX     #$07
.LAA23          LDA     L0062,X
                LSR     A
                ORA     L0062,X
                STA     L0062,X
                DEX
                BPL     LAA23

                BIT     UMATLO
                BPL     LAA47

                BRA     LAA3C

.LAA33          BIT     UMATLO
                BPL     LAA9E

                PHY
                PHX
                JSR     LAA0A

.LAA3C          LDA     L0069
                LSR     A
                ROR     A
                ORA     L0069
                ROL     A
                EOR     #$FF
                TSB     L0069
.LAA47          JSR     VSTRING

                JSR     LA2EA

.LAA4E          ORA     (L00B5,X)
LAA4F = LAA4E+1
                ADC     (HIMEM,X)
                INC     LE8FF
                CPX     #$09
                BNE     LAA4F

                JSR     VSTRING

                JSR     L2017

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                NOP
                PLX
                PLY
                RTS

.LAA6B          JSR     ackesc

                JMP     LA3C9

.LAA71          BIT     L00FF
                BMI     LAA6B

                BIT     LINE
                BMI     LAAAB

                CMP     termin
                BEQ     LAAA7

                BIT     L002A
                BMI     LAA18

                BVS     LAA8B

                LDA     #$20
                BIT     UMATLO
                BPL     LAA8B

                LDA     #$5F
.LAA8B          PHA
                LDA     #$20
                BIT     L002A
                BNE     LAA9D

                BIT     UMATHI
                BMI     LAA9D

                LDA     #$20
                JSR     OSWRCH

                PLA
                RTS

.LAA9D          PLA
.LAA9E          PHY
                TAY
                LDA     L0600,Y
                PLY
.LAAA4          JMP     (WRCHV)

.LAAA7          LDA     #$0D
                BRA     LAAA4

.LAAAB          PHY
                TAY
                LDA     L0600,Y
                LDY     L004E
                BEQ     LAAB7

                JSR     OSBPUT

.LAAB7          PLY
                RTS

.LAAB9          BIT     LINE
                BMI     LAAF7

                LDA     #$0A
                INC     L0502
                BNE     LAAC7

                INC     L0503
.LAAC7          DEC     L0045
                BNE     LAAA4

                JSR     OSWRCH

                PHX
                PHY
                LDX     L0518
                LDY     L0519
                LDA     LINBUFF
                LSR     A
                BCC     LAAE2

                LDX     L051A
                LDY     L051B
.LAAE2          DEC     L0045
                DEC     L0045
                JSR     LA984

                LDA     #$FF
                STA     L0045
                INC     LINBUFF
                BNE     LAAF5

                INC     LINBUFF+1
.LAAF5          PLY
                PLX
.LAAF7          RTS

.LAAF8          LDA     #$20
                TSB     L002A
                LDA     UMATHI
                PHA
                JSR     LAB15

                PLA
                STA     UMATHI
                BIT     L0047
                BPL     LAAF7

                LDA     #$20
                TRB     L002A
                JSR     LAB15

                LDA     #$20
                TSB     L002A
                RTS

.LAB15          LDA     L0049
                JSR     LABE6

                STZ     L0016
                LDA     L0014
                BNE     LAB27

                SEC
                LDA     L003D
                SBC     L002E
                STA     L0016
.LAB27          LDA     L003C
                CMP     #$FF
                BNE     LAB2F

                LDA     SMATHI+1
.LAB2F          JSR     LABE6

                LDA     L0017
                BPL     LAB3F

                SEC
                LDA     L003D
                INC     A
                SBC     L002E
                JSR     LABE7

.LAB3F          BIT     SMATLO
                BPL     LAB4D

                SEC
                LDA     L003D
                ADC     #$01
                SBC     L002E
                JSR     LABE6

.LAB4D          LDY     #$00
                LDX     #$00
                LDA     L003E
                BEQ     LAB71

                LSR     A
                STA     NUMMAR
                LDA     #$00
                BIT     L003B
                BMI     LAB60

                LDA     L0016
.LAB60          LDX     #$01
.LAB62          CMP     L003E
                BCC     LAB6B

                INX
                SBC     L003E
                BCS     LAB62

.LAB6B          STX     MARKSB
                STA     L0016
                LDX     #$00
.LAB71          JSR     LA576

                CMP     termin
                BEQ     LABD7

                CMP     mark_count
                BNE     LABA2

                TXA
                LDX     #$FF
.LAB7F          INX
                PHA
                LDA     L051C,X
                BEQ     LAB9F

                PLA
                CMP     L051C,X
                BCS     LAB7F

                SEC
                SBC     L051C,X
                EOR     #$FF
                INC     A
                PHX
                JSR     LABE6

                PLX
                LDA     L051C,X
                TAX
                DEX
                BRA     LABCF

.LAB9F          PLX
                LDA     #$20
.LABA2          CMP     #$20
                BNE     LABCC

                CPX     L004B
                BCC     LABCC

                PHX
                LDX     MARKSB
.LABAD          DEX
                BEQ     LABB7

                LDA     #$20
                JSR     LAA71

                BRA     LABAD

.LABB7          PLX
                SEC
                LDA     NUMMAR
                SBC     L0016
                STA     NUMMAR
                BCS     LABCA

                ADC     L003E
                STA     NUMMAR
                LDA     #$20
                JSR     LAA71

.LABCA          LDA     #$20
.LABCC          JSR     LAA71

.LABCF          INY
                INX
                CPX     L002E
                BCC     LAB71

                LDA     termin
.LABD7          JMP     LAA71

.LABDA          LDY     L004E
                BEQ     LABE5

                STZ     L004E
                LDA     #$00
                JSR     OSFIND

.LABE5          RTS

.LABE6          ASL     A
.LABE7          LSR     A
                BEQ     LAC04

                TAX
                LDA     #$09
                BIT     L002A
                BMI     LABF3

                LDA     #$20
.LABF3          BIT     LINE
                BPL     LABFE

                LDA     #$20
                JSR     LAAAB

                BRA     LAC01

.LABFE          JSR     OSWRCH

.LAC01          DEX
                BNE     LABF3

.LAC04          RTS

                JSR     L9810

                BVC     LAC7C

                ADC     L0073
                JSR     L4853

                EOR     #$46
                JSR     L6F74

                JSR     L6F63

                ROR     L6974
                ROR     L6575
                NOP
.LAC20          PHX
                PHY
.LAC22          JSR     L8473

                LDX     #$FF
                LDY     #$FF
                LDA     #$81
                JSR     OSBYTE

                CPX     #$FF
                BNE     LAC22

                LDA     #$0F
                LDX     #$FF
                JSR     OSBYTE

                PLY
                PLX
                RTS

.LAC3C          PHX
                PHY
                AND     #$0F
                ASL     A
                TAX
                LDA     LINBUFF,X
                STA     TEMP
                LDA     LINBUFF+1,X
                TAX
                AND     #$0F
                STA     TEMP+1
                ORA     TEMP
                PHP
                TXA
                LSR     A
                LSR     A
                LSR     A
                LSR     A
                PLP
                BNE     LAC62

                CMP     #$08
                BCC     LAC66

                LDA     #$00
                BRA     LAC66

.LAC62          CMP     #$08
                BCS     LACA7

.LAC66          PHA
                LDX     #$04
                LDA     #$30
                STA     L0070
                STA     L0071
                STA     L0072
.LAC71          LDA     #$30
                STA     L006B,X
                SEC
.LAC76          LDA     TEMP
                SBC     LBBF7,X
                TAY
.LAC7C          LDA     TEMP+1
                SBC     LBBFC,X
                BCC     LAC8B

                STY     TEMP
                STA     TEMP+1
                INC     L006B,X
                BNE     LAC76

.LAC8B          DEX
                BPL     LAC71

                PLA
                STA     TEMP
                LDX     #$08
.LAC93          DEX
                CPX     TEMP
                BEQ     LAC9E

                LDA     L006B,X
                AND     #$0F
                BEQ     LAC93

.LAC9E          STX     TEMP
                PLY
                PLA
                SEC
                ADC     TEMP
                TAX
                RTS

.LACA7          PHA
                CMP     #$0A
                BCS     LACF4

                LDA     #$FF
                PHA
                LDX     #$0C
.LACB1          SEC
                LDA     TEMP
                SBC     LAD1F,X
                TAY
                LDA     TEMP+1
                SBC     LAD2C,X
                BCC     LACD4

                STY     TEMP
                STA     TEMP+1
                TXA
                ASL     A
                TAY
                LDA     LAD39,Y
                PHA
                LDA     LAD3A,Y
                CMP     #$20
                BEQ     LACB1

                PHA
                BRA     LACB1

.LACD4          DEX
                BPL     LACB1

.LACD7          PLA
                INX
                STA     L006B,X
                CMP     #$FF
                BNE     LACD7

                DEX
.LACE0          PLA
                AND     #$01
                BEQ     LAC9E

                STX     TEMP
.LACE7          LDA     L006B,X
                ORA     #$20
                STA     L006B,X
                DEX
                BPL     LACE7

                LDX     TEMP
                BRA     LAC9E

.LACF4          LDA     TEMP
                BNE     LACFA

                DEC     TEMP+1
.LACFA          DEC     TEMP
                LDY     #$00
.LACFE          LDA     TEMP
                SEC
.LAD01          INY
                SBC     #$1A
                BCS     LAD01

                STA     TEMP
                LDA     TEMP+1
                BEQ     LAD10

                DEC     TEMP+1
                BRA     LACFE

.LAD10          LDA     TEMP
                ADC     #$5B
                LDX     #$00
.LAD16          STA     L006B,X
                INX
                DEY
                BNE     LAD16

                DEX
                BRA     LACE0

.LAD1F          ORA     (TMAX,X)
                ORA     ADDR+1
                ASL     A
                PLP
                AND     (L005A)
                STZ     L0090
                STY     L00E8
.LAD2C          BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $01

                ORA     (PAJE+1,X)
.LAD39          EOR     #$20
LAD3A = LAD39+1
                EOR     #$56
                LSR     HIMEM,X
                EOR     #$58
                CLI
                JSR     L4C58

                JMP     L5820

                JSR     L4443

                JSR     L4D44

.LAD51          EOR     L6120
LAD53 = LAD51+2
.LAD54          ROR     TMAX
LAD55 = LAD54+1
                LDX     addrpointer
                ROR     LA624
                JMP     (LA694)

                BVS     LAD91

                TAY
                STA     L63A6,Y
                ADC     L009F
                LDX     L0063
                PLA
                LDY     L00A6
                DEC     L64A7,X
                ADC     LA6FD
                STZ     L0073
                AND     (L00A7,X)
                ADC     L0066
                PHA
                ADC     L0068
                LSR     L65A7,X
                ROR     LA794
                ADC     L0070
                STZ     L66A7
                ROR     L00A6
                ROR     L006F
.LAD91          ROL     L68A7,X
                ADC     L0054
                ADC     #$63
                LDY     L69A7,X
                EOR     (L00A7)
                ADC     #$6E
                ADC     #$6F
                DEX
                ADC     #$78
                CPX     L6AA7
                ADC     OSHWM,X
                TAY
                JMP     (L056C)

                TAY
                JMP     (L0D73)

                TAY
                JMP     (L1576)

                TAY
                ROR     L2665
                TAY
                ROR     L336A
                TAY
                ROR     L366E
                TAY
                ROR     SIZE+1
                PLA
                AND     (L00A7)
                BVS     LAE0B

                TAY
                TAY
                BVS     LAE45

                TAY
                BVS     LAE4C

                ADC     L00A8
                ADC     (L0066)
                ADC     L73A8
                BVS     LAE58

                TAY
                STA     L74A8,Y
                ADC     (L009E,X)
                TAY
                STZ     L0063,X
                LDX     L00A8,Y
                STZ     L0069,X
                LDY     L74A8,X
                ADC     (L00CA)
                TAY
                ADC     L006C,X
                TAY
.LADFF          JSR     LENGTH

                STA     CURRLEN
                TAY
                BEQ     LAE0B

                CMP     PAGEWI
                BNE     LAE13

.LAE0B          LDA     UPDATE
                CMP     #$01
                BNE     LAE13

                INC     UPDATE
.LAE13          JSR     LBC01

                JSR     L961A

                LDA     L0036
                CMP     UPDATE
                BCC     LAE21

                STA     UPDATE
.LAE21          STZ     L0036
                LDA     UPDATE
                CMP     #$06
                BNE     LAE2C

                JSR     L963C

.LAE2C          LDA     UPDATE
                BEQ     LAE6E

                CMP     #$05
                BCC     LAE4B

                LDA     L0038
                JSR     L98BD

                STA     L0038
                DEC     A
                STA     L0034
                BMI     LAE4B

                LDA     #$00
                LDX     L000E
.LAE44          LDY     L000F
LAE45 = LAE44+1
                JSR     LAF1F

                BCS     LAE64

.LAE4B          LDX     UPDATE
LAE4C = LAE4B+1
                CPX     #$03
                BEQ     LAE71

                CPX     #$04
                BEQ     LAE90

                LDY     PAGELE
.LAE57          STY     L0034
LAE58 = LAE57+1
                LDA     L0038
                LDX     GE
                LDY     GE+1
                JSR     LAF1F

                BCC     LAE6E

.LAE64          LDA     #$02
                CMP     UPDATE
                BCS     LAE6C

                LDA     #$05
.LAE6C          STA     L0036
.LAE6E          STZ     UPDATE
                RTS

.LAE71          JSR     CSROST

                LDA     #$0A
                JSR     OSWRCH

                LDX     #$FF
.LAE7B          INX
                LDA     L0733,X
                STA     L0732,X
                CPX     PAGELE
                BNE     LAE7B

                STZ     L0733,X
                JSR     STATUS

                LDA     PAGELE
                BRA     LAEA9

.LAE90          JSR     VSTRING

                ASL     LEA0B,X
                LDY     PAGELE
.LAE98          LDA     L0732,Y
                STA     L0733,Y
                DEY
                BPL     LAE98

                STZ     L0732
                JSR     STATUS

                LDA     #$00
.LAEA9          STA     L0034
                LDX     L005D
                LDY     L005E
                BNE     LAF1F

                TAY
.LAEB2          PHY
                JSR     L9838

                LDA     #$20
                JSR     OSWRCH

                LDA     #$00
                PLY
.LAEBE          STA     L002D
                CMP     L0732,Y
                BCS     LAF19

                LDA     machtype
                BEQ     LAEEA

                LDA     #$1F
                JSR     OSWRCH

                LDA     L002D
                INC     A
                JSR     OSWRCH

                TYA
                JSR     OSWRCH

                JSR     VSTRING

                PHP
                ORA     TEMP
                BRK
                EQUB    $00

                BRK
                EQUB    $00

                BRK
                EQUB    $00

                NOP
                JMP     LAF19

.LAEEA          LDA     #$1C
                JSR     OSWRCH

                LDA     L002D
                INC     A
                JSR     OSWRCH

                PHX
                LDA     options
                AND     #$07
                TAX
                TYA
                CLC
                ADC     LB3DB,X
                PLX
                PHA
                JSR     OSWRCH

                LDA     L0732,Y
                JSR     OSWRCH

                PLA
                JSR     OSWRCH

                LDA     #$0C
                JSR     OSWRCH

                PHY
                JSR     DECWIN

                PLY
.LAF19          LDA     L002D
                STA     L0732,Y
                RTS

.LAF1F          STA     L0033
                STX     L000E
                STY     L000F
                LDX     #$00
                LDA     UPDATE
                CMP     #$01
                BEQ     LAF31

                CMP     #$02
                BNE     LAF39

.LAF31          LDX     SCRNX
                CPX     CURRLEN
                BCC     LAF39

                LDX     CURRLEN
.LAF39          PHX
                LDY     L0033
                JSR     L983A

                PLY
                DEY
.LAF41          INY
                LDA     (L000E),Y
                CMP     termin
                BEQ     LAF51

                JSR     LAFEC

                CPY     PAGEWI
                BNE     LAF41

                BRA     LAF54

.LAF51          JSR     LAFFB

.LAF54          STY     L002E
                LDY     MARKX
.LAF58          DEY
                BMI     LAF8A

                STY     L002F
                SEC
                LDA     UMATLO,Y
                SBC     L000E
                TAX
                LDA     UMATHI,Y
                SBC     L000F
                BCC     LAF58

                BNE     LAF58

                CPX     L002E
                BEQ     LAF73

                BCS     LAF58

.LAF73          LDY     L0033
                JSR     L983A

                LDA     L002F
                CLC
                ADC     #$31
                JSR     LB007

                LDX     L002E
                INX
                JSR     L983A

                LDY     L002F
                BRA     LAF58

.LAF8A          LDA     L002E
                LDY     L0033
                JSR     LAEBE

                JSR     L98A9

                BCS     LAFD1

                LDA     UPDATE
                CMP     #$01
                BEQ     LAFEA

                LDY     L0033
                CPY     L0034
                BCS     LAFEA

                LDA     UPDATE
                CMP     #$06
                BEQ     LAFCA

                LDA     NEXTREADFLAG
                BNE     LAFC8

                LDA     #$81
                LDX     #$00
                JSR     OSBYTEwithY

                CPY     #$FF
                BEQ     LAFCA

                JSR     L8473

                INC     NEXTREADFLAG
                STX     NEXTCHR
                STX     L0080
                TXA
                BNE     LAFC8

                JSR     L8470

                STA     NEXTCHR
.LAFC8          SEC
                RTS

.LAFCA          INC     L0033
                LDX     #$00
                JMP     LAF39

.LAFD1          LDX     L002E
                LDY     L0033
                JSR     L983A

                LDA     #$2A
                JSR     LB007

                BRA     LAFE4

.LAFDF          LDY     L0033
                JSR     LAEB2

.LAFE4          INC     L0033
                CPY     PAGELE
                BCC     LAFDF

.LAFEA          CLC
                RTS

.LAFEC          CMP     #$20
                BCC     LB005

                CMP     #$7F
                BNE     LAFF8

                LDA     #$3F
                BRA     LB007

.LAFF8          JMP     OSWRCH

.LAFFB          LDA     #$20
                BIT     options
                BEQ     LAFF8

                LDA     #$24
                BRA     LB007

.LB005          ORA     #$40
.LB007          PHA
                LDA     options
                AND     #$07
                CMP     #$07
                BNE     LB015

                PLA
                LDA     #$FF
                BRA     LAFF8

.LB015          JSR     LB030

                PLA
                JSR     OSWRCH

.LB01C          LDA     #$11
                JSR     OSWRCH

                LDA     #$80
                JSR     OSWRCH

                LDA     #$11
                JSR     OSWRCH

                LDA     #$07
                JMP     OSWRCH

.LB030          JSR     VSTRING

                ORA     (L0087),Y
                ORA     (STRING),Y
                NOP
                RTS

.LB039          JSR     L95D3

                BCC     LB042

                LDA     SCRNX
                BEQ     LB0A4

.LB042          DEC     SCRNX
                BPL     LB0A4

                LDA     PAGEWI
                STA     SCRNX
.LB04A          JSR     L95D3

                BCS     LB0A4

                LDA     #$01
                JSR     L9909

                LDA     L0051
                CMP     L0038
                BCS     LB05E

.LB05A          DEC     L0038
                BPL     LB0A4

.LB05E          LDA     L0038
                JSR     L98BD

                CMP     L0038
                CLC
                BNE     LB05A

                LDA     L000E
                STA     L005D
                LDA     L000F
                STA     L005E
                LDA     #$04
                STA     UPDATE
                RTS

.LB075          LDY     SCRNX
                LDA     (GE),Y
                CMP     termin
                BNE     LB08C

                JSR     LB0B8

                BCS     LB089

                JSR     LADFF

                STZ     SCRNX
                BRA     LB0A4

.LB089          PLA
                PLA
                RTS

.LB08C          JSR     LB0A7

                JSR     LADFF

                BRA     LB0A4

.LB094          LDA     SCRNX
                BNE     LB039

                JSR     LB04A

                BCS     LB089

                JSR     LADFF

                LDA     CURRLEN
                STA     SCRNX
.LB0A4          STZ     UPDATE
                RTS

.LB0A7          LDA     SCRNX
                CMP     PAGEWI
                BEQ     LB0B1

                INC     SCRNX
                BRA     LB0A4

.LB0B1          JSR     ENDTES

                BCS     LB0A4

                STZ     SCRNX
.LB0B8          JSR     ENDTES

                BCS     LB0A4

                LDA     #$01
                JSR     L9968

                LDA     L0038
                CMP     L0052
                BCS     LB0CC

                INC     L0038
                BRA     LB0A4

.LB0CC          STZ     L005E
                SEC
                LDA     PAGELE
                SBC     L0052
                JSR     L9882

                LDA     L002E
                BNE     LB0E2

                LDA     L000E
                STA     L005D
                LDA     L000F
                STA     L005E
.LB0E2          LDA     #$03
                STA     UPDATE
                CLC
.LB0E7          RTS

                LDA     CURRLEN
                CMP     SCRNX
                BCS     LB0F5

                STA     SCRNX
                BRA     LB0F5

.LB0F2          JSR     LB075

.LB0F5          LDY     SCRNX
                LDA     (GE),Y
                JSR     LB130

                BCC     LB0F2

.LB0FE          LDY     SCRNX
                LDA     (GE),Y
                JSR     LB130

                BCC     LB0E7

                JSR     LB075

                BRA     LB0FE

.LB10C          JSR     LB094

                LDY     SCRNX
                LDA     (GE),Y
                JSR     LB130

                BCC     LB10C

.LB118          LDY     SCRNX
                LDA     (GE),Y
                JSR     LB130

                BCC     LB0A7

                JSR     LB094

                BRA     LB118

                LDA     CURRLEN
                CMP     SCRNX
                BCS     LB10C

                STA     SCRNX
.LB12E          SEC
                RTS

.LB130          CMP     #$30
                BCC     LB12E

                CMP     #$3A
                BCC     LB140

                AND     #$DF
                CMP     #$41
                BCC     LB12E

                CMP     #$5B
.LB140          RTS

.LB141          LDX     L0022
                LDY     L0023
.LB145          STX     GS
                STY     GS+1
                LDA     TMAX
                STA     GE
                LDA     TMAX+1
                STA     GE+1
                STZ     CURSED
                STZ     NEXTREADFLAG
                STZ     MARKX
                LDA     termin
                STA     (OSHWM)
                STA     (TMAX)
.STFILE         LDX     L0022
                LDY     L0023
                JSR     GPBKXY

                STZ     SCRNX
.LB166          RTS

                LDA     L0052
                STA     L0038
                LDX     TMAX
                LDY     TMAX+1
                JSR     L996F

                JMP     NORMAX

                LDA     #$87
                JSR     OSBYTE

                LDA     options
                AND     #$07
                TAX
                LDA     LB3E2,X
                STY     STRING
                EOR     STRING
                AND     #$07
                BEQ     LB166

.LB18A          LDA     #$16
                JSR     OSWRCH

                LDA     options
                AND     #$07
                TAY
                LDA     LB3E2,Y
                ORA     #$80
                JMP     OSWRCH

.LB19C          JSR     LB18A

                LDA     #$83
                JSR     OSBYTE

                STX     OSHWM
                STY     PAJE+1
                INC     A
                JSR     OSBYTE

                STX     HIMEM
                STY     HYMEM+1
                CLC
                LDA     OSHWM
                ADC     #$01
                STA     L0022
                LDA     PAJE+1
                ADC     #$00
                STA     L0023
                LDA     HIMEM
                SBC     #$00
                STA     TMAX
                LDA     HYMEM+1
                SBC     #$00
                STA     TMAX+1
                JSR     L962E

                LDA     PAGELE
                SEC
                SBC     #$04
                STA     L0052
                LDA     #$04
                STA     L0051
                RTS

                LDA     L0038
                STA     L0051
                BRA     LB1EA

                LDA     L0038
                STA     L0052
                BRA     LB1EA

                STZ     L0051
                LDA     PAGELE
                STA     L0052
.LB1EA          STZ     UPDATE
                RTS

                JSR     L97FE

                JMP     (L6165)

                ADC     (HIMEM)
                STZ     L0065,X
                SEI
                STZ     HIMEM,X
                EOR     L732C,Y
                PLA
                ROR     L002D
                ROR     L0039
                JSR     L6528

                SEI
                ADC     L0063
                AND     #$2C
                JSR     L6428

                ADC     #$73
                ADC     (L0072,X)
                STZ     L0029
                EOR     L20EA,X
                CMP     LD096,X
                TAX
                BNE     LB22D

.LB221          JSR     STATUS

                JMP     L858F

.LB227          LDA     #$02
                STA     MODFLG
                BRA     LB221

.LB22D          CMP     #$99
                BEQ     LB23B

                ORA     #$20
                CMP     #$64
                BEQ     LB227

                CMP     #$79
                BNE     LB221

.LB23B          JSR     L84EB

                JMP     L857E

                LDA     MODFLG
                CMP     #$01
                BNE     LB274

                JSR     L97FE

                EQUS    "Overwrite text [Y,f2]:"

                EQUB    $07,$EA,$20,$DD,$96,$D0,$03,$AA
                EQUB    $F0,$B7,$C9,$82,$F0,$06,$29,$DF
                EQUB    $C9,$59,$D0,$AD

.LB274          JSR     L97FE

                EQUS    "Type filename to load:"

                EQUB    $EA,$20,$14,$84,$A0,$00,$20,$5F
                EQUB    $83,$4C,$82,$85,$20,$9F,$BC,$C9
                EQUB    $01,$F0,$24,$20,$EA,$97

                EQUS    "to save:"

                EQUB    $07,$EA,$20,$14,$84,$20,$B0,$BC
                EQUB    $A0,$00,$20,$D8,$83,$64,$2C,$A6
                EQUB    $5F,$A4,$60,$20,$6F,$99,$4C,$1F
                EQUB    $BD,$20,$EA,$97

                EQUS    "for MARK TO CURSOR save:"

                EQUB    $07,$EA,$20,$14,$84,$20,$B0,$BC
                EQUB    $A0,$00,$B2,$06,$C5,$81,$F0,$19
                EQUB    $C9,$8B,$F0,$15,$A5,$06,$85,$61
                EQUB    $A5,$07,$85,$62,$20,$DC,$83,$A6
                EQUB    $5F,$A4,$60,$20,$6F,$99,$4C,$1F
                EQUB    $BD,$00,$01

                EQUS    "Bad use of stored name"

                EQUB    $00,$20,$6D,$BC,$20,$A0,$99,$20
                EQUB    $EA,$97

                EQUS    "to insert:"

                EQUB    $EA,$20,$14,$84,$A5,$10,$85,$08
                EQUB    $A5,$11,$85,$09,$A5,$12,$A6,$13
                EQUB    $A0,$00,$2C,$7A,$80,$20,$6C,$83
                EQUB    $86,$10,$84,$11,$20,$F2,$96,$A6
                EQUB    $08,$A4,$09,$20,$10,$99,$4C,$47
                EQUB    $98,$A9,$01,$85,$24,$20,$B4,$95
                EQUB    $20,$FE,$97

                EQUS    "Command line"

                EQUB    $EA,$20,$E7,$FF,$A9,$2A,$20,$EE
                EQUB    $FF,$A9,$00,$A0,$B3,$A2,$97,$20
                EQUB    $F1,$FF,$B0,$15,$AD,$00,$05,$C9
                EQUB    $0D,$F0,$11,$A2,$00,$A0,$05,$20
                EQUB    $F7,$FF,$80,$E0,$00,$05,$EE,$20
                EQUB    $FF,$20,$32,$81,$A9,$DA,$A2,$00
                EQUB    $20,$AF,$95,$20,$32,$85,$04,$03
                EQUB    $0F,$0D,$1A,$EA,$20,$75,$B1,$20
                EQUB    $91,$95,$4C,$87,$85,$A9,$01,$85
                EQUB    $3A,$20,$B4,$95,$4C,$06,$97,$00
                EQUB    $01

                EQUS    "Only 0,1,3,4,6,7,D or K"

.LB3DB          EQUB    $00,$00,$07,$00,$00,$0E,$00

.LB3E2          EQUB    $00,$01,$00,$03,$04,$00,$06,$07
                EQUB    $20,$FE,$97

                EQUS    "New Mode:"

                EQUB    $EA,$20,$70,$84,$20,$EE,$FF,$C9
                EQUB    $38,$B0,$0E,$E9,$2F,$90,$BD,$C9
                EQUB    $02,$F0,$B9,$C9,$05,$F0,$B5,$80
                EQUB    $10,$29,$DF,$C9,$44,$F0,$08,$C9
                EQUB    $4B,$D0,$A9,$A9,$02,$80,$02,$A9
                EQUB    $05,$48,$A8,$B9,$E2,$B3,$48,$20
                EQUB    $EB,$84,$A9,$82,$20,$F4,$FF,$E8
                EQUB    $D0,$14,$C8,$D0,$11,$68,$48,$09
                EQUB    $80,$AA,$A9,$85,$20,$F4,$FF,$E4
                EQUB    $10,$98,$E5,$11,$90,$5A,$FA,$A9
                EQUB    $07,$14,$2B,$68,$05,$2B,$20,$67
                EQUB    $85,$20,$9C,$B1

.LB452          LDA     L04FF
                CMP     PAJE+1
                BCC     LB4AA

                CMP     HYMEM+1
                BCS     LB4AA

                CMP     L04FD
                BCC     LB4AA

                LDA     L04FD
                CMP     PAJE+1
                BCC     LB4AA

                LDA     L04FC
                STA     ARGP
                LDA     L04FD
                STA     ARGP+1
                SEC
                LDA     L04FE
                SBC     ARGP
                TAX
                LDA     L04FF
                SBC     ARGP+1
                TAY
                BCC     LB4AA

                LDA     L0022
                STA     VARP
                LDA     L0023
                STA     VARP+1
                PHY
                PHX
                JSR     L84AF

                PLA
                CLC
                ADC     L0022
                TAX
                PLA
                ADC     L0023
                TAY
                STZ     L04FF
                JMP     L8584

                JSR     STFILE

                BRK
                EQUB    $02

                EQUS    "No room"

.LB4AA          BRK
                EQUB    $02

                EQUS    "No old text found"

                EQUB    $00

.LB4BE          STZ     L002F
                STZ     LINE
                STZ     L004D
.LB4C4          LDY     L002F
                LDA     (TEMP),Y
                CMP     #$0D
                BEQ     LB4FC

                CMP     #$3A
                BCS     LB54D

                SBC     #$2F
                BCC     LB54D

                STA     L002D
                LDA     #$0A
                LDX     #$00
                LDY     #$00
                CLC
.LB4DD          PHA
                TXA
                ADC     LINE
                TAX
                TYA
                ADC     L004D
                TAY
                BCS     LB54D

                PLA
                DEC     A
                BNE     LB4DD

                TXA
                ADC     L002D
                STA     LINE
                BCC     LB4F6

                INY
                BEQ     LB54D

.LB4F6          STY     L004D
                INC     L002F
                BNE     LB4C4

.LB4FC          RTS

                LDA     #$01
                STA     LINE
                STZ     L004D
                LDA     L0022
                STA     STRING
                LDA     L0023
                STA     STRING+1
.LB50B          LDA     (STRING)
                CMP     termin
                BNE     LB517

                INC     LINE
                BNE     LB517

                INC     L004D
.LB517          INC     STRING
                BNE     LB51D

                INC     STRING+1
.LB51D          LDA     STRING
                CMP     GS
                LDA     STRING+1
                SBC     GS+1
                BCC     LB50B

                JSR     L97FE

                EOR     (L0074,X)
                JSR     L696C

                ROR     L2065
                NOP
                JSR     LBBC5

                JSR     VSTRING

                EQUS    ", new line:"

                EQUB    $EA,$20,$1C,$B0,$20,$14,$84,$D0
                EQUB    $1D

.LB54D          BRK
                EQUB    $01

                EQUS    "Bad number"

.LB559          BRK
                EQUB    $02

                EQUS    "Line not found"

                EQUB    $00

.LB56A          JSR     LB4BE

                SEC
                LDA     LINE
                SBC     #$01
                STA     LINE
                LDA     L004D
                SBC     #$00
                STA     L004D
                BCC     LB54D

                JSR     STFILE

                JSR     LA96C

.LB582          LDA     LINE
                ORA     L004D
                BEQ     LB59F

.LB588          LDA     #$01
                JSR     L988A

                BCS     LB559

                LDA     L002D
                CMP     termin
                BNE     LB588

                LDA     LINE
                BNE     LB59B

                DEC     L004D
.LB59B          DEC     LINE
                BRA     LB582

.LB59F          LDA     L0051
                BNE     LB5A5

                LDA     #$04
.LB5A5          STA     L0038
                JMP     L996B

.LB5AA          STZ     L0047
                STZ     L0057
                STZ     L0045
                STZ     L0048
                STZ     L0049
                STZ     L0054
                STZ     L0046
                BRA     LB5BD

.LB5BA          JSR     LB6EF

.LB5BD          LDY     L0046
                LDA     LINBUFF,Y
                STA     L002D
                INC     L0046
                CMP     #$0D
                RTS

                JSR     LB5AA

.LB5CC          STZ     mark_count
                STZ     L0056
                STZ     L0055
                LDA     L002D
                CMP     #$0D
                BEQ     LB624

                CMP     #$2F
                BEQ     LB622

                CMP     #$5E
                BNE     LB5E4

                INC     L0055
                BRA     LB5E8

.LB5E4          CMP     #$2A
                BNE     LB5EF

.LB5E8          INC     mark_count
                LDX     #$80
                JSR     LB5BA

.LB5EF          CMP     #$7E
                BNE     LB5F8

                LDX     #$81
                JSR     LB5BA

.LB5F8          CMP     #$5B
                BNE     LB633

                INC     L0054
                LDX     #$86
                JSR     LB6EF

                JSR     LB6EF

                STY     L004B
                JSR     LB5BD

.LB60B          JSR     LB733

                LDA     L002D
                CMP     #$5D
                BNE     LB60B

                DEC     L0054
                LDA     L0047
                LDY     L004B
                STA     L0600,Y
                JSR     LB5BD

                BRA     LB636

.LB622          INC     L0057
.LB624          JSR     LB6ED

                JSR     LB5BD

                LDA     L0047
                STA     L003C
                LDA     L0057
                BNE     LB68F

                RTS

.LB633          JSR     LB733

.LB636          LDA     L0055
                BEQ     LB63F

                LDX     #$8B
                JSR     LB6EF

.LB63F          LDA     L0056
                BEQ     LB659

                LDX     L0045
                CPX     #$0A
                BCS     LB5CC

                INC     L0045
                LDA     L0049
                STA     L0728,X
                LDA     mark_count
                BNE     LB65E

                LDA     L0048
                STA     L071E,X
.LB659          INC     L0049
.LB65B          JMP     LB5CC

.LB65E          INC     L0048
                LDA     L0048
                CMP     #$05
                BCS     LB66F

                ORA     #$80
                STA     L071E,X
                STZ     L0049
                BRA     LB65B

.LB66F          BRK
                EQUB    $01

                EQUS    "Too many find multiples"

                EQUB    $00

.LB689          JSR     LB5BD

.LB68C          JSR     LB6EF

.LB68F          LDA     #$FF
                STA     L0054
                LDA     L002D
                CMP     #$0D
                BEQ     LB6ED

                LDX     #$88
                CMP     #$26
                BEQ     LB689

                CMP     #$5C
                BNE     LB6A9

                JSR     LB5BD

                TAX
                BRA     LB689

.LB6A9          LDX     #$87
                CMP     #$25
                BNE     LB6C1

                JSR     LB6EF

                JSR     LB5BD

                SEC
                SBC     #$30
                BCC     LB6D2

                CMP     L0045
                BCS     LB6D2

                TAX
                BPL     LB689

.LB6C1          JSR     LB7BE

                STX     L004A
                TXA
                BPL     LB68C

                LDX     #$89
                JSR     LB6EF

                LDX     L004A
                BRA     LB68C

.LB6D2          BRK
                EQUB    $01

                EQUS    "Bad replace field number"

                EQUB    $00

.LB6ED          LDX     #$8C
.LB6EF          LDY     L0047
                LDA     L0054
                BNE     LB713

                CPX     #$41
                BCC     LB713

                CPX     #$7B
                BCS     LB713

                CPX     #$5B
                BCC     LB705

                CPX     #$61
                BCC     LB713

.LB705          TXA
                ORA     #$20
                TAX
                LDA     #$8A
                STA     L0600,Y
                INY
                INC     L0047
                BEQ     LB720

.LB713          TXA
                STA     L0600,Y
                BPL     LB71B

                INC     L0056
.LB71B          INC     L0047
                BEQ     LB720

                RTS

.LB720          BRK
                EQUB    $01

                EQUS    "Syntax incorrect"

                EQUB    $00

.LB733          LDA     L002D
                CMP     #$7E
                BNE     LB752

                LDX     #$81
                JSR     LB6EF

                JSR     LB5BD

                BNE     LB752

                BRK
                EQUB    $01

                EQUS    "Error with ~"

                EQUB    $00

.LB752          CMP     #$5C
                BNE     LB776

                INC     L0054
                JSR     LB5BD

                BNE     LB76C

                BRK
                EQUB    $01

                EQUS    "Error with \"

                EQUB    $00

.LB76C          TAX
                JSR     LB5BD

                JSR     LB6EF

                DEC     L0054
                RTS

.LB776          LDX     #$82
                CMP     #$2E
                BEQ     LB788

                LDX     #$83
                CMP     #$40
                BEQ     LB788

                LDX     #$84
                CMP     #$23
                BNE     LB78E

.LB788          JSR     LB5BD

                JMP     LB6EF

.LB78E          JSR     LB7BE

                STX     L004A
                LDA     L002D
                CMP     #$2D
                BNE     LB7B1

                INC     L0054
                LDX     #$85
                JSR     LB6EF

                JSR     LB5BD

                LDX     L004A
                JSR     LB6EF

                JSR     LB7BE

                JSR     LB6EF

                DEC     L0054
                RTS

.LB7B1          TXA
                BPL     LB7BB

                LDX     #$89
                JSR     LB6EF

                LDX     L004A
.LB7BB          JMP     LB6EF

.LB7BE          STZ     L002E
                LDA     L002D
                BMI     LB7F5

                CMP     #$7C
                BNE     LB7D6

                JSR     LB5BD

                BEQ     LB802

                CMP     #$21
                BNE     LB7E3

                INC     L002E
                JSR     LB5BD

.LB7D6          CMP     #$24
                BEQ     LB7F3

                CMP     #$7C
                BNE     LB7F5

                JSR     LB5BD

                BEQ     LB802

.LB7E3          CMP     #$3F
                BNE     LB7EB

                LDA     #$7F
                BRA     LB7F5

.LB7EB          BCC     LB7F5

                AND     #$DF
                SBC     #$40
                BRA     LB7F5

.LB7F3          LDA     termin
.LB7F5          PHA
                JSR     LB5BD

                PLA
                LDY     L002E
                BEQ     LB800

                ORA     #$80
.LB800          TAX
                RTS

.LB802          BRK
                EQUB    $01

                EQUS    "Error with |"

                EQUB    $00

.LB811          LDY     #$00
.LB813          STZ     L003B
                LDA     L0014
                STA     L0016
                CMP     TEXTP
                LDA     L0015
                STA     L0017
                SBC     TEXTP+1
                BCC     LB848

                LDA     L0053
                BNE     LB840

                JSR     LBA35

                LDA     GS
                STA     STRING
                LDA     GS+1
                STA     STRING+1
                INC     L0053
                LDA     ENDP
                STA     TEXTP
                LDA     ENDP+1
                STA     TEXTP+1
                LDY     #$00
                BRA     LB848

.LB840          SEC
                RTS

.LB842          INC     L0016
                BNE     LB848

                INC     L0017
.LB848          JSR     L8473

                LDA     L0600,Y
                CMP     #$8C
                BEQ     LB867

                CMP     #$80
                BEQ     LB8C2

                JSR     LB8E5

                BEQ     LB842

.LB85B          LDX     L003B
                BNE     LB882

                INC     L0014
                BNE     LB811

                INC     L0015
                BRA     LB811

.LB867          LDA     L0014
                STA     L0706
                LDA     L0015
                STA     L070C
                SEC
                LDA     L0016
                SBC     L0014
                STA     L0712
                LDA     L0017
                SBC     L0015
                STA     L0718
                CLC
                RTS

.LB882          STY     L0055
                CLC
                LDA     L0706,X
                ADC     L0712,X
                STA     L0016
                LDA     L070C,X
                ADC     L0718,X
                STA     L0017
                LDA     L0700,X
                TAY
                JSR     LB8E5

                BNE     LB8AA

                LDX     L003B
                INC     L0712,X
                BNE     LB842

                INC     L0718,X
                BRA     LB842

.LB8AA          LDX     L0055
                LDA     L05FF,X
                CMP     #$8B
                BNE     LB8BE

                INY
                LDX     L003B
                LDA     L0712,X
                ORA     L0718,X
                BNE     LB848

.LB8BE          DEC     L003B
                BRA     LB85B

.LB8C2          INC     L003B
                LDX     L003B
                INY
                TYA
                STA     L0700,X
                LDA     L0016
                STA     L0706,X
                LDA     L0017
                STA     L070C,X
                STZ     L0712,X
                STZ     L0718,X
                JSR     LB8E5

                JMP     LB848

.LB8E1          PLP
.LB8E2          LDA     #$01
                RTS

.LB8E5          LDA     L0016
                CMP     ENDP
                BNE     LB8F1

                LDA     L0017
                CMP     ENDP+1
                BEQ     LB8E2

.LB8F1          LDA     L0600,Y
                CMP     #$81
                PHP
                BNE     LB8FA

                INY
.LB8FA          INY
                LDA     L05FF,Y
                BMI     LB906

                CMP     (L0016)
                BNE     LB97D

                BRA     LB981

.LB906          CMP     #$82
                BEQ     LB981

                CMP     #$8A
                BEQ     LB93E

                CMP     #$83
                BEQ     LB94A

                CMP     #$8B
                BEQ     LB8E1

                CMP     #$84
                BEQ     LB962

                CMP     #$85
                BEQ     LB92C

                CMP     #$86
                BEQ     LB96E

                INY
                LDA     L05FF,Y
                CMP     (L0016)
                BNE     LB97D

                BEQ     LB981

.LB92C          INY
                INY
                LDA     (L0016)
                CMP     L05FE,Y
                BCC     LB97D

                CMP     L05FF,Y
                BCC     LB981

                BNE     LB97D

                BRA     LB981

.LB93E          INY
                LDA     (L0016)
                ORA     #$20
                CMP     L05FF,Y
                BNE     LB97D

                BRA     LB981

.LB94A          LDA     (L0016)
                CMP     #$5F
                BEQ     LB981

                CMP     #$41
                BCC     LB964

                CMP     #$7B
                BCS     LB97D

                CMP     #$5B
                BCC     LB981

                CMP     #$61
                BCC     LB97D

                BRA     LB981

.LB962          LDA     (L0016)
.LB964          CMP     #$30
                BCC     LB97D

                CMP     #$3A
                BCS     LB97D

                BRA     LB981

.LB96E          LDA     L0600,Y
                STA     L004B
                INY
.LB974          JSR     LB8E5

                BEQ     LB97F

                CPY     L004B
                BNE     LB974

.LB97D          PLP
                RTS

.LB97F          LDY     L004B
.LB981          PLA
                AND     #$02
                RTS

                JSR     LBA35

                LDA     #$01
                STA     MODFLG
                LDA     L0016
                STA     GE
                LDA     L0017
                STA     GE+1
                LDA     L003C
                STA     L0039
.LB998          LDA     GS
                CMP     L0014
                LDA     GS+1
                SBC     L0015
                BCS     CHNRRE

                LDY     L0039
                INC     L0039
                LDA     L0600,Y
                BPL     LB9EE

                CMP     #$8C
                BEQ     LBA2E

                CMP     #$87
                BEQ     LB9C2

                CMP     #$88
                BEQ     LB9BE

                INC     L0039
                LDA     L0601,Y
                BRA     LB9EE

.LB9BE          LDY     #$00
                BRA     LBA05

.LB9C2          INC     L0039
                LDA     L0601,Y
                TAX
                LDA     L071E,X
                BMI     LBA02

                TAY
                BEQ     LB9E1

                CLC
                LDA     L0706,Y
                ADC     L0712,Y
                STA     TEMP
                LDA     L070C,Y
                ADC     L0718,Y
                BNE     LB9E7

.LB9E1          LDA     L0014
                STA     TEMP
                LDA     L0015
.LB9E7          STA     TEMP+1
.LB9E9          LDY     L0728,X
LB9EA = LB9E9+1
                LDA     (TEMP),Y
.LB9EE          STA     (GS)
                INC     GS
                BNE     LB998

                INC     GS+1
                BRA     LB998

.CHNRRE         BRK
                EQUB    $02

                EQUS    "No room"

                EQUB    $00

.LBA02          AND     #$7F
                TAY
.LBA05          LDA     L0706,Y
                STA     ARGP
                LDA     L070C,Y
                STA     ARGP+1
                LDA     GS
                STA     VARP
                LDA     GS+1
                STA     VARP+1
                CLC
                LDA     L0712,Y
                TAX
                ADC     GS
                STA     GS
                LDA     L0718,Y
                TAY
                ADC     GS+1
                STA     GS+1
                JSR     L84AF

                JMP     LB998

.LBA2E          RTS

                JSR     L96BE

                ORA     #$20
                RTS

.LBA35          LDX     L0014
                LDY     L0015
                JMP     L996F

                JSR     DFINIT

                JSR     L97FE

                EQUS    "Global replace:"

                EQUB    $EA,$20,$4A,$84,$20,$46,$84,$D0
                EQUB    $0F,$CD,$64,$04,$F0,$66,$B9,$64
                EQUB    $04,$91,$06,$C8,$10,$F8,$A0,$00
                EQUB    $B1,$06,$99,$64,$04,$C8,$C0,$64
                EQUB    $D0,$F6,$20,$C9,$B5,$20,$B0,$BC
                EQUB    $64,$4C,$64,$4D,$64,$53,$A6,$12
                EQUB    $A4,$13,$86,$14,$84,$15,$20,$11
                EQUB    $B8,$B0,$15,$E6,$4C,$D0,$02,$E6
                EQUB    $4D,$A5,$57,$D0,$06,$A6,$16,$A4
                EQUB    $17,$80,$E7,$20,$85,$B9,$80,$DE
                EQUB    $A6,$00,$A4,$01,$20,$10,$99,$20
                EQUB    $47,$98,$20,$FF,$AD,$AE,$E5,$07
                EQUB    $E8,$20,$06,$98,$20,$EA,$20,$C5
                EQUB    $BB,$20,$06,$98

                EQUS    " found"

                EQUB    $EA,$60,$00,$01

                EQUS    "No previous string"

                EQUB    $00,$20,$FE,$97

                EQUS    "Find and replace:"

                EQUB    $EA,$9C,$53,$07,$20,$4A,$84,$20
                EQUB    $46,$84,$D0,$0F,$CD,$00,$04,$F0
                EQUB    $C6,$B9,$00,$04,$91,$06,$C8,$10
                EQUB    $F8,$A0,$00,$B1,$06,$99,$00,$04
                EQUB    $C8,$C0,$64,$D0,$F6,$20,$C9,$B5
                EQUB    $20,$31,$BE,$20,$A0,$99,$A5,$4C
                EQUB    $85,$37,$A5,$04,$85,$5F,$85,$5B
                EQUB    $A5,$05,$85,$60,$85,$5C,$85,$53
                EQUB    $A6,$12,$A4,$13,$86,$14,$84,$15
                EQUB    $20,$11,$B8,$B0,$62,$20,$35,$BA
                EQUB    $E6,$4C,$D0,$02,$E6,$4D,$AD,$53
                EQUB    $07,$D0,$4E,$20,$1F,$BD,$A5,$52
                EQUB    $85,$38,$20,$FF,$AD,$A9,$05,$85
                EQUB    $35,$20,$3E,$BE,$20,$2F,$98,$20
                EQUB    $16,$96,$20,$2F,$BA,$C9,$65,$D0
                EQUB    $18,$8D,$53,$07,$A9,$01,$85,$4C
                EQUB    $64,$4D,$20,$6D,$BC,$A5,$57,$D0
                EQUB    $05,$20,$79,$BE,$E6,$57,$4C,$97
                EQUB    $BB,$C9,$63,$D0,$06,$A6,$16,$A4
                EQUB    $17,$80,$A9,$C9,$72,$D0,$D3,$20
                EQUB    $6D,$BC,$A5,$57,$D0,$03,$20,$79
                EQUB    $BE,$20,$85,$B9,$4C,$2E,$BB,$20
                EQUB    $47,$98,$A9,$06,$85,$35,$20,$FF
                EQUB    $AD,$20,$08,$97,$AD,$53,$07,$F0
                EQUB    $03,$4C,$AE,$BA,$AE,$E5,$07,$E8
                EQUB    $20,$06,$98

                EQUS    " Not found"

                EQUB    $EA,$60

.LBBC5          JSR     LB030

                LDX     #$04
                STX     STRING
.LBBCC          STZ     STRING+1
.LBBCE          SEC
                LDA     LINE
                SBC     LBBF7,X
                TAY
                LDA     L004D
                SBC     LBBFC,X
                BCC     LBBE4

                STY     LINE
                STA     L004D
                INC     STRING+1
                BRA     LBBCE

.LBBE4          LDA     STRING+1
                BNE     LBBEC

                DEC     STRING
                BPL     LBBF3

.LBBEC          ORA     #$30
                JSR     OSWRCH

                STZ     STRING
.LBBF3          DEX
                BPL     LBBCC

                RTS

.LBBF7          ORA     (ARGP,X)
                STZ     L00E8
.LBBFB          BPL     LBBFD

LBBFC = LBBFB+1
.LBBFD          BRK
                EQUB    $00

.LBC01          JSR     LBC2A

.LBC04          STZ     MARKSB
                LDX     MARKX
.LBC08          DEX
                BMI     LBC29

                LDY     SMATLO,X
                STY     UMATLO,X
                CPY     GE
                LDA     SMATHI,X
                STA     UMATHI,X
                SBC     GE+1
                BCS     LBC08

                INC     MARKSB
                SEC
                TYA
                SBC     L003D
                STA     UMATLO,X
                LDA     UMATHI,X
                SBC     L003E
                STA     UMATHI,X
                BCS     LBC08

.LBC29          RTS

.LBC2A          SEC
                LDA     GE
                SBC     GS
                STA     L003D
                LDA     GE+1
                SBC     GS+1
                STA     L003E
                RTS

.CLRMAK         JSR     FINEPO

                JSR     LBC2A

                JSR     LBC04

                LDX     MARKX
                CPX     #$02
                BNE     LBC61

                LDA     UMATLO+1
                CMP     UMATLO
                LDA     UMATHI+1
                SBC     UMATHI
                BCS     LBC61

                LDA     UMATLO
                LDY     UMATLO+1
                STA     UMATLO+1
                STY     UMATLO
                LDA     UMATHI
                LDY     UMATHI+1
                STA     UMATHI+1
                STY     UMATHI
.LBC61          LDA     MARKX
                STA     NUMMAR
                STZ     MARKX
                JSR     STATUS

                LDA     NUMMAR
.MKRFEX         RTS

                LDA     MARKX
                BEQ     MKRFEX

                BRK
                EQUB    $01

                EQUS    "Mark(s) set"

                EQUB    $00

.NMBLOK         LDA     GE
                STA     TEXTP
                LDA     GE+1
                STA     TEXTP+1
                LDA     NUMMAR
                BEQ     NBLKEX

                CMP     #$01
                BNE     BADMARK

                LDX     UMATLO
                LDY     UMATHI
                DEC     MARKSB
                BNE     NBLKEX

                JSR     GPBKXY

                LDX     TEXTP
                LDY     TEXTP+1
.NBLKEX         RTS

.DFINIT         JSR     TEMPSX

                JSR     CLRMAK

                CMP     #$02
                BEQ     BADMARK

                PHA
                LDA     LINE
                STA     SCRNX
                PLA
                RTS

                JSR     NMBLOK

                BNE     DBLKEP

                JSR     STFILE

                LDX     TMAX
                LDY     TMAX+1
.DBLKEP         STX     ENDP
                STY     ENDP+1
.LBCC0          RTS

.MVBLOK         JSR     CLRMAK

                CMP     #$02
                BNE     BADMARK

                LDA     UMATLO+1
                CMP     GE
                BNE     MVBLOJ

                LDA     UMATHI+1
                CMP     GE+1
                BNE     MVBLOJ

                LDA     GS
                STA     UMATLO+1
                LDA     GS+1
                STA     UMATHI+1
                INC     MARKSB
.MVBLOJ         LDA     MARKSB
                DEC     A
                BNE     LBCC0

.BADMARK        BRK
                EQUB    $01

                EQUS    "Bad marking"

                EQUB    $00

.LBCF1          JSR     FINEPO

                LDX     MARKX
                CPX     #$02
                BEQ     BADMARK

                LDA     GE
                STA     SMATLO,X
                LDA     GE+1
                STA     SMATHI,X
                JSR     NORMAL

                INC     MARKX
                JMP     STATUS

                JSR     CLRMAK

                JMP     NORMAL

                JSR     CLRMAK

                JSR     NMBLOK

                BEQ     BADMARK

                STX     GE
                STY     GE+1
                JSR     MODIFY

.NORMAX         JSR     NORMAL

                LDA     STRING
                STA     SCRNX
                RTS

.MKCPY          JSR     MVBLOK

                SEC
                LDA     UMATLO+1
                SBC     UMATLO
                TAX
                LDA     UMATHI+1
                SBC     UMATHI
                TAY
                LDA     MARKSB
                BEQ     MKCPYO

                STX     STRING
                STY     STRING+1
                SEC
                LDA     SMATLO
                SBC     STRING
                STA     SMATLO
                LDA     SMATHI
                SBC     STRING+1
                STA     SMATHI
                LDA     SMATLO+1
                SBC     STRING
                STA     SMATLO+1
                LDA     SMATHI+1
                SBC     STRING+1
                STA     SMATHI+1
.MKCPYO         JSR     CHECKR

                LDA     UMATLO
                STA     ARGP
                LDA     UMATHI
                STA     ARGP+1
                STX     GE
                STX     VARP
                STY     GE+1
                STY     VARP+1
                JSR     CPFD2

                LDX     #$01
                STX     MODFLG
                INX
                STX     MARKX
                JSR     STATUS

                JMP     NORMAL

.MKMVE          JSR     MVBLOK

                LDX     UMATLO
                LDY     UMATHI
                LDA     MARKSB
                BEQ     MVBEFC

                STX     ARGP
                STY     ARGP+1
                LDA     UMATLO+1
                STA     VARP
                LDA     UMATHI+1
                STA     VARP+1
                LDX     GS
                LDY     GS+1
                BRA     MVSTP3

.MVBEFC         STX     VARP
                STY     VARP+1
                LDA     GE
                STA     ARGP
                LDA     GE+1
                STA     ARGP+1
                LDX     UMATLO+1
                LDY     UMATHI+1
.MVSTP3         STX     ENDP
                STY     ENDP+1
.MVLOOP         SEC
                LDA     VARP
                SBC     ARGP
                STA     SIZE
                LDA     VARP+1
                SBC     ARGP+1
                STA     SIZE+1
                LDA     ENDP
                SBC     VARP
                TAX
                LDA     ENDP+1
                SBC     VARP+1
                TAY
                CPX     SIZE
                SBC     SIZE+1
                BCS     MV2GE

                STX     SIZE
                STY     SIZE+1
.MV2GE          LDA     SIZE
                ORA     SIZE+1
                BEQ     MVNORM

                BCS     MV2GE1

                LDX     VARP
                LDY     VARP+1
                JSR     MVSWAP

                CLC
                TYA
                ADC     TEMP
                STA     ARGP
                LDA     #$00
                ADC     TEMP+1
                STA     ARGP+1
                BCC     MVLOOP

.MV2GE1         SEC
                LDA     ENDP
                SBC     SIZE
                STA     ENDP
                TAX
                LDA     ENDP+1
                SBC     SIZE+1
                STA     ENDP+1
                TAY
                JSR     MVSWAP

                BRA     MVLOOP

.MVNORM         LDA     #$05
                STA     UPDATE
                JSR     NORMAL

                JMP     MODIFY

.MVSWAP         LDA     ARGP
                STA     TEMP
                LDA     ARGP+1
                STA     TEMP+1
                STX     ADDR
                STY     ADDR+1
                INC     SIZE+1
                LDY     #$00
.MVNINC         CPY     SIZE
                BNE     MVSWLP

                DEC     SIZE+1
                BEQ     TEMPSE

.MVSWLP         LDA     (TEMP),Y
                TAX
                LDA     (ADDR),Y
                STA     (TEMP),Y
                TXA
                STA     (ADDR),Y
                INY
                BNE     MVNINC

                INC     TEMP+1
                INC     ADDR+1
                BRA     MVNINC

.TEMPSX         LDA     SCRNX
                STA     LINE
                LDA     CURRLEN
                CMP     SCRNX
                BCS     TEMPSE

                STA     SCRNX
.TEMPSE         RTS

                JSR     L97FE

                EQUS    "C(ontinue), E(nd of file replace), R(eplace) or ESCAPE"

                EQUB    $EA,$60,$20,$FE,$97

                EQUS    "Replace by:"

                EQUB    $EA,$20,$4A,$84,$20,$46,$84,$20
                EQUB    $B6,$B5,$A5,$3C,$85,$47,$4C,$8F
                EQUB    $B6

                EQUS    ".he"

                EQUB    $0D

                EQUS    ".en"

                EQUB    $0D

                EQUS    ".fo"

                EQUB    $0D

                EQUS    ".ce"

                EQUB    $0D

                EQUS    "Page .r0"

                EQUB    $0D

                EQUS    ".ff.en"

                EQUB    $0D

                EQUS    ".he"

                EQUB    $0A

                EQUS    ".en"

                EQUB    $0A

                EQUS    ".fo"

                EQUB    $0A

                EQUS    ".ce"

                EQUB    $0A

                EQUS    "Page .r0"

                EQUB    $0A

                EQUS    ".ff.en"

                EQUB    $0A,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                EQUB    $FF

.BeebDisEndAddr
SAVE "edit150.bin",BeebDisStartAddr,BeebDisEndAddr

